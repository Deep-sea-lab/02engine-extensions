// Extension Wrapper
// By Xbodwf(https://github.com/Xbodwf)

(()=>{var ae={en:{"ccwpolyfill.noticeTitle":"Notice","ccwpolyfill.cancelBtn":"Cancel","ccwpolyfill.confirmBtn":"Accept","ccwpolyfill.warning":"Warning","ccwpolyfill.experimentalWarning":"You're using Experimental features","ccwpolyfill.extensionKeeper":"Extension Keeper","ccwpolyfill.screenshotCommentMessage":"This page requests your screenshot comment (though this is not CCW and has no effect)","ccwpolyfill.promptTitle":"Prompt","ccwpolyfill.okMeow":"Okay meow...","ccwpolyfill.meowQuestion":"Meow?","ccwpolyfill.meowAlert":"Meow~"},"zh-cn":{"ccwpolyfill.noticeTitle":"\u901A\u77E5","ccwpolyfill.cancelBtn":"\u53D6\u6D88","ccwpolyfill.confirmBtn":"\u786E\u8BA4","ccwpolyfill.warning":"\u8B66\u544A","ccwpolyfill.experimentalWarning":"\u60A8\u6B63\u5728\u4F7F\u7528\u5B9E\u9A8C\u6027\u529F\u80FD","ccwpolyfill.extensionKeeper":"\u6269\u5C55\u9632\u5378\u8F7D\u5668","ccwpolyfill.screenshotCommentMessage":"\u8BE5\u9875\u9762\u8BF7\u6C42\u60A8\u622A\u56FE\u8BC4\u8BBA(\u867D\u7136\u8FD9\u4E0D\u662FCCW\u5E76\u6CA1\u6709\u4EC0\u4E48\u7528)","ccwpolyfill.promptTitle":"\u63D0\u793A","ccwpolyfill.okMeow":"\u597D\u7684\u55B5...","ccwpolyfill.meowQuestion":"\u55B5\uFF1F","ccwpolyfill.meowAlert":"\u55B5~"}},kt=(y,u)=>{if(!u)return y;let l=ae[u.toLowerCase()];return l&&l[y]||y},Et=y=>{let u=Scratch.translate.language,l=ae[u.toLowerCase()];return l&&l[y]||y};var le=class extends Array{installedChunks={};moduleRegistry;chunkToModuleMap={9445:47156,5777:8713,3814:20210,1868:60214,3977:32845,6767:11298,1743:94165,4991:52214,2606:80893,9244:20184,1169:35340,8450:93034,3347:63969,2259:18018,3854:68005,3632:73632,2226:8338,8635:83787,7372:69219,1417:54398,6552:93614,9986:21002,155:50780,7490:15679,9468:93150,321:69434,1561:51509,7119:48656,6127:48859,1431:46798,2730:3276,9139:13740,2581:66493,1081:40862,4071:92413,1138:15698,8364:33824,4279:23542,5437:49014,9583:40721,5537:44418,1179:94954,7384:49684,4732:64345,9051:91803,1825:36679,388:63960,4451:92409,1757:87533};constructor(){super();let u=Array.prototype.push.bind(this);this.push=function(p){u(p);let[v,b,d]=p,c,g;for(let f=0;f<v.length;f++)g=v[f],this.installedChunks[g]&&this.installedChunks[g][0](),this.installedChunks[g]=0;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(this.moduleRegistry||(this.moduleRegistry={}),this.moduleRegistry[c]=b[c]);return d&&d(this.requireFn||this.require.bind(this)),this.loadExtensionFromModules(b),p}}loadExtensionFromModules(u){let l=[],p=new Set,v=Object.values(u).filter(g=>typeof g=="function");v.forEach(g=>{if(typeof g=="function"){let f=g.toString();if(f.includes("return N.e(")){let w=f.match(/return N\.e\((\d+)\)\.then\(N\.bind\(N,\s*(\d+)\)\)/);if(w){let C=parseInt(w[1]),x=parseInt(w[2]);p.add(C),console.log(`[CCW Polyfill] Executing extension loader checked 
 chunkId=${C}, moduleId=${x}`)}}}}),v.filter(g=>g.length===3).forEach(g=>{try{let f=this.requireN(void 0,g,u);l.push(f)}catch(f){console.warn("[CCW Polyfill] Failed to load module:",f)}});for(let[g,f]of Object.entries(this.chunkToModuleMap))if(p.has(parseInt(g)))try{if(this.moduleRegistry&&this.moduleRegistry[f]){let w=this.requireN(f);w&&(l.push(w),console.log(`[CCW Polyfill] Loaded chunkId=${g} moduleId=${f}`))}}catch(w){console.warn(`[CCW Polyfill] Failed to load chunkId=${g} moduleId=${f}:`,w)}let d,c;if(l.length>0)try{let g=l[0];g.__esModule===!0?d=new g.default(Scratch.vm):d=new g(Scratch.vm),c=d.getInfo(),d.getInfo=()=>{let f=c.blocks;if(typeof f=="object"&&f!==null)for(let[w,C]of Object.entries(f))typeof C=="string"&&C.startsWith("---")&&C.length!==3&&(f[w]={blockType:"label",text:C.substring(3)});return/^[a-z0-9]+$/i.test(c.id)||(c.id=c.id.replace(/[^a-zA-Z0-9]/g,"")),c},Scratch.extensions.register(d),Scratch.vm.runtime[`ext_${c.id}`]=d,console.log("[CCW Polyfill] Successfully registered extension:",c.id)}catch(g){console.warn("[CCW Polyfill] First Method failed...",g);try{let f=this.convertBlocks(c.blocks);d._______ccw_polyfill__temp=()=>"__ccw_polyfill";let w=this.createProxiedFunctions(d);w.getInfo=function(){let C=d.getInfo.call(this),x=C.blocks;if(typeof x=="object"&&x!==null)for(let[R,O]of Object.entries(x))typeof O=="string"&&O.startsWith("---")&&O.length!==3&&(x[R]={blockType:"label",text:O.substring(3)});return/^[a-z0-9]+$/i.test(C.id)||(C.id=C.id.replace(/[^a-zA-Z0-9]/g,"")),C},window.ScratchExtensions.register(c.name||c.id,{blocks:f},w),Scratch.vm.runtime[`ext_${c.id}`]=d}catch(f){console.warn("[CCW Polyfill] Failed to register extensions.",f)}}}require=this.requireN.bind(this);requireN(u,l,p={}){let v={exports:{}},b=c=>this.require(c,void 0,p);b.r=c=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},b.d=(c,g,f)=>{for(let w in g)Object.prototype.hasOwnProperty.call(c,w)||Object.defineProperty(c,w,{enumerable:!0,get:typeof g[w]=="function"&&f?function(){return g[w].call(this)}:g[w]})},b.o=(c,g)=>Object.prototype.hasOwnProperty.call(c,g),b.n=c=>{let g=c&&c.__esModule?function(){return c.default}:function(){return c};return b.d(g,{a:g}),g},b.s=null,b.c=this.moduleRegistry||{},b.m=p,b.p="",b.i=c=>c,b.e=c=>this.installedChunks[c]===0?Promise.resolve():(this.installedChunks[c]||(this.installedChunks[c]=[g=>{this.installedChunks[c]=0,g()}]),new Promise((g,f)=>{this.installedChunks[c].push(g)})),b.t=(c,g)=>{if(g&1&&(c=b(c)),g&8||g&4&&typeof c=="object"&&c&&c.__esModule)return c;let f=Object.create(null);if(b.r(f),Object.defineProperty(f,"default",{enumerable:!0,value:c}),g&2&&typeof c!="string")for(let w in c)b.d(f,w,function(C){return c[C]}.bind(null,w));return f},b.h="",b.w={},b.oe=c=>{throw c},b.nc=void 0;let d=typeof u>"u"?l:this.moduleRegistry[u];return typeof d=="function"&&d(v,v.exports,b),v.exports}uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,u=>{let l=Math.random()*16|0;return(u=="x"?l:l&3|8).toString(16)})}convertBlocks(u){return u.map(l=>[this.stringifyScratchXBlockType(l),l.text==null?"":l.text,l.opcode==null?"_______ccw_polyfill__temp":l.opcode,l.arguments==null?{}:l.arguments,l.defaultValue==null?"":l.defaultValue])}stringifyScratchXBlockType(u){let{blockType:l,async:p=!1}=u;return l===Scratch.BlockType.COMMAND?p?"w":"":l===Scratch.BlockType.REPORTER?p?"R":"r":l===Scratch.BlockType.BOOLEAN?"b":l===Scratch.BlockType.HAT?"h":p?"R":"r"}getAllFunctions(u){let l=new Map,p=u;for(;p&&p!==Object.prototype;){let v=Object.getOwnPropertyNames(p);for(let b of v)b!=="constructor"&&typeof p[b]=="function"&&(l.has(b)||l.set(b,p[b]));p=Object.getPrototypeOf(p)}return l}createProxiedFunctions(u){let l={};return this.getAllFunctions(u).forEach((v,b)=>{l[b]=(...d)=>v.call(u,...d)}),l}};var pe=class{convert(u){return{targets:(u.runtime.targets||[]).map(b=>this.#t(b)),monitors:this.#c(u.runtime._monitorState),extensions:Array.from(u.runtime.extensionManager._loadedExtensions.keys()),meta:{semver:"3.0.0",vm:u.runtime.runtimeOptions?.version||"0.2.0",agent:"Mozilla/5.0 (Scratch 3.0)",platform:{name:"CCW Polyfill Generator"}}}}async saveProjectSb3(u,l={}){let p=this.convert(u),b=await(await window.showSaveFilePicker({suggestedName:"project.sb3",types:[{description:"Scratch 3 Project",accept:{"application/x.scratch.sb3":[".sb3"]}}]})).createWritable();return await b.write(JSON.stringify(p)),await b.close(),p}#t(u){return{isStage:u.isStage,name:u.sprite.name,variables:this.#e(u.variables),lists:this.#n(u.lists),broadcasts:this.#i(u.broadcasts),blocks:this.#r(u.blocks),comments:this.#a(u.comments),currentCostume:u.currentCostume,costumes:this.#l(u.sprite.costumes),sounds:this.#p(u.sprite.sounds),volume:u.volume,layerOrder:u.layerOrder,tempo:u.tempo,videoTransparency:u.videoTransparency,videoState:u.videoState,textToSpeechLanguage:u.textToSpeechLanguage,visible:u.visible,x:u.x,y:u.y,size:u.size,direction:u.direction,draggable:u.draggable,rotationStyle:u.rotationStyle}}#e(u){let l={};for(let[p,v]of Object.entries(u))l[p]=[v.name,v.value];return l}#n(u){let l={};for(let[p,v]of Object.entries(u))l[p]=[v.name,[...v.value]];return l}#i(u){let l={};for(let[p,v]of Object.entries(u))l[p]=v;return l}#r(u){let l={};for(let[p,v]of Object.entries(u))v&&(l[p]={opcode:v.opcode,next:v.next,parent:v.parent,inputs:this.#o(v.inputs),fields:this.#s(v.fields),shadow:v.shadow,topLevel:v.topLevel,x:v.x,y:v.y});return l}#o(u){let l={};for(let[p,v]of Object.entries(u))l[p]=[...v];return l}#s(u){let l={};for(let[p,v]of Object.entries(u))l[p]=[...v];return l}#a(u){let l={};for(let[p,v]of Object.entries(u))v&&(l[p]={blockId:v.blockId,x:v.x,y:v.y,width:v.width,height:v.height,minimized:v.minimized,text:v.text});return l}#l(u){return u.map(l=>({assetId:l.assetId,name:l.name,bitmapResolution:l.bitmapResolution,md5ext:l.md5,dataFormat:l.dataFormat,rotationCenterX:l.rotationCenterX,rotationCenterY:l.rotationCenterY}))}#p(u){return u.map(l=>({assetId:l.assetId,name:l.name,dataFormat:l.dataFormat,format:l.format,rate:l.rate,sampleCount:l.sampleCount,md5ext:l.md5}))}#c(u){return u.map(l=>({id:l.id,mode:l.mode,opcode:l.opcode,params:l.params,spriteName:l.spriteName,value:l.value,width:l.width,height:l.height,x:l.x,y:l.y,visible:l.visible,sliderMin:l.sliderMin,sliderMax:l.sliderMax,isDiscrete:l.isDiscrete}))}};function xi(y,u=Et("ccwpolyfill.noticeTitle"),l=Et("ccwpolyfill.cancelBtn"),p=Et("ccwpolyfill.confirmBtn"),v,b){let d=document.createElement("div");d.className="modal-overlay";let c=document.createElement("div");c.className="modal-container",c.innerHTML=`
    <div class="modal-header">
      <h3 class="modal-title">${u}</h3>
    </div>
    <div class="modal-body">
      ${y}
    </div>
    <div class="modal-footer">
      <button class="modal-btn cancel">${l}</button>
      <button class="modal-btn confirm">${p}</button>
    </div>
  `,d.appendChild(c),document.body.appendChild(d),setTimeout(()=>d.classList.add("active"),10),c.querySelector(".cancel").addEventListener("click",()=>{C(d),b&&b()}),c.querySelector(".confirm").addEventListener("click",()=>{C(d),v&&v()}),d.addEventListener("click",x=>{x.target===d&&(C(d),b&&b())});let w=x=>{x.key==="Escape"&&(C(d),b&&b(),document.removeEventListener("keydown",w))};document.addEventListener("keydown",w);function C(x){x.classList.remove("active"),setTimeout(()=>{document.body.removeChild(x)},300)}}function yi(){let y=`
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.modal-overlay.active {
    opacity: 1;
    visibility: visible;
}

.modal-container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    width: 90%;
    max-width: 500px;
    transform: translateY(-20px);
    transition: all 0.3s ease;
}

.modal-overlay.active .modal-container {
    transform: translateY(0);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
    margin-bottom: 15px;
}

.modal-title {
    margin: 0;
    font-size: 1.5em;
    color: #333;
}

.modal-body {
    margin-bottom: 20px;
    color: #555;
    line-height: 1.5;
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.modal-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
    transition: background-color 0.2s ease;
}

.modal-btn.cancel {
    background-color: #ccc;
    color: #333;
}

.modal-btn.cancel:hover {
    background-color: #bbb;
}

.modal-btn.confirm {
    background-color: #007bff;
    color: white;
}

.modal-btn.confirm:hover {
    background-color: #0056b3;
}
    `,u=document.createElement("style");u.textContent=y,document.head.appendChild(u)}function Ci(y,u){yi(),es(y,u)}function es(y,u){y.exportProject=async()=>{try{return await u.saveProjectSb3(y)}catch(l){return console.error("[CCW Polyfill] Failed to export project:",l),null}},y.getFormatMessage=l=>p=>typeof l[Scratch.translate.language][p.id]>"u"?p.default:l[Scratch.translate.language][p.id],y.runtime.getFormatMessage=y.getFormatMessage,typeof y.toJSON!="function"&&(y.toJSON=u.convert.bind(u,y)),typeof y.saveProjectSb3!="function"&&(y.saveProjectSb3=u.saveProjectSb3.bind(u,y)),y.ccwPolyfill={convert:u.convert.bind(u,y),save:u.saveProjectSb3.bind(u,y)},y.renderer.layerManager={rootFolder:""},y.runtime.ccwAPI={commentWithStageSnapshot(){return new Promise(l=>{l(xi(kt("ccwpolyfill.screenshotCommentMessage"),kt("ccwpolyfill.noticeTitle"),kt("ccwpolyfill.okMeow"),kt("ccwpolyfill.meowQuestion"),()=>{alert(kt("ccwpolyfill.meowAlert"))}))})},getCoinCount(){return new Promise(l=>{l(0)})},getDeviceType(){return new Promise(l=>{l("PC")})},getExtensionURLById(l){return new Promise(p=>{p("")})},getOnlineExtensionsConfig(){return new Promise(l=>{l({})})},getProjectDonateRanking(){return new Promise(l=>{l({curUserDonatedRecord:{bucks:0,name:"",oid:"",avatar:""},rankingList:void 0})})},getProjectSb3Id(){return""},getProjectStats(){return new Promise(l=>{l({commentCount:0,favoriteCount:0,likeCount:0,totalBucks:0})})},getProjectUUID(){return""},getUserInfo(){return new Promise(l=>{l({userId:"",userName:"",uuid:"",oid:"",avatar:"",constellation:-1,following:0,followers:0,liked:0,gender:-1,pendant:"",reputationScore:{rank:"EXCELLENT",score:100,studentOid:""}})})},getOpenVM(){return y},isFavoriteProject(){return new Promise(l=>{l(!0)})},isFollowed(){return new Promise(l=>{l(!0)})},isLikedProject(){return new Promise(l=>{l(!0)})},isMyFans(){return new Promise(l=>{l(!0)})},preActionInterceptor(){},redirect(){},requestCoins(){},requestFollow(){},sendPlayEventCode(){},setAvatar(){},showShare(){},uploadAssetToCloud(l,p){}}}function Pi(){(self.webpackChunkscratch_extensions=self.webpackChunkscratch_extensions||[]).push([[8392],{83392:(y,u,l)=>{let p=l(29734);class v{static toNumber(d){if(typeof d=="number")return Number.isNaN(d)?0:d;let c=Number(d);return Number.isNaN(c)?0:c}static toBoolean(d){return typeof d=="boolean"?d:typeof d=="string"?d!==""&&d!=="0"&&d.toLowerCase()!=="false":!!d}static toString(d){return String(d)}static toRgbColorList(d){let c=v.toRgbColorObject(d);return[c.r,c.g,c.b]}static toRgbColorObject(d){let c;return typeof d=="string"&&d.substring(0,1)==="#"?(c=p.hexToRgb(d),c||(c={r:0,g:0,b:0,a:255})):c=p.decimalToRgb(v.toNumber(d)),c}static isWhiteSpace(d){return d===null||typeof d=="string"&&d.trim().length===0}static compare(d,c){let g=Number(d),f=Number(c);if(g===0&&v.isWhiteSpace(d)?g=NaN:f===0&&v.isWhiteSpace(c)&&(f=NaN),isNaN(g)||isNaN(f)){let w=String(d).toLowerCase(),C=String(c).toLowerCase();return w<C?-1:w>C?1:0}return g===1/0&&f===1/0||g===-1/0&&f===-1/0?0:g-f}static isInt(d){return typeof d=="number"?!!isNaN(d)||d===parseInt(d,10):typeof d=="boolean"||typeof d=="string"&&d.indexOf(".")<0}static get LIST_INVALID(){return"INVALID"}static get LIST_ALL(){return"ALL"}static toListIndex(d,c,g){if(typeof d!="number"){if(d==="all")return g?v.LIST_ALL:v.LIST_INVALID;if(d==="last")return c>0?c:v.LIST_INVALID;if(d==="random"||d==="any")return c>0?1+Math.floor(Math.random()*c):v.LIST_INVALID}return(d=Math.floor(v.toNumber(d)))<1||d>c?v.LIST_INVALID:d}}y.exports=v},29734:y=>{class u{static get RGB_BLACK(){return{r:0,g:0,b:0}}static get RGB_WHITE(){return{r:255,g:255,b:255}}static decimalToHex(p){p<0&&(p+=16777216);let v=Number(p).toString(16);return v=`#${"000000".substr(0,6-v.length)}${v}`,v}static decimalToRgb(p){let v=p>>24&255;return{r:p>>16&255,g:p>>8&255,b:255&p,a:v>0?v:255}}static hexToRgb(p){p=p.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((b,d,c,g)=>d+d+c+c+g+g));let v=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(p);return v?{r:parseInt(v[1],16),g:parseInt(v[2],16),b:parseInt(v[3],16)}:null}static rgbToHex(p){return u.decimalToHex(u.rgbToDecimal(p))}static rgbToDecimal(p){return(p.r<<16)+(p.g<<8)+p.b}static hexToDecimal(p){return u.rgbToDecimal(u.hexToRgb(p))}static hsvToRgb(p){let v=p.h%360;v<0&&(v+=360);let b=Math.max(0,Math.min(p.s,1)),d=Math.max(0,Math.min(p.v,1)),c=Math.floor(v/60),g=v/60-c,f=d*(1-b),w=d*(1-b*g),C=d*(1-b*(1-g)),x,R,O;switch(c){default:case 0:x=d,R=C,O=f;break;case 1:x=w,R=d,O=f;break;case 2:x=f,R=d,O=C;break;case 3:x=f,R=w,O=d;break;case 4:x=C,R=f,O=d;break;case 5:x=d,R=f,O=w}return{r:Math.floor(255*x),g:Math.floor(255*R),b:Math.floor(255*O)}}static rgbToHsv(p){let v=p.r/255,b=p.g/255,d=p.b/255,c=Math.min(Math.min(v,b),d),g=Math.max(Math.max(v,b),d),f=0,w=0;return c!==g&&(f=60*((v===c?3:b===c?5:1)-(v===c?b-d:b===c?d-v:v-b)/(g-c))%360,w=(g-c)/g),{h:f,s:w,v:g}}static mixRgb(p,v,b){if(b<=0)return p;if(b>=1)return v;let d=1-b;return{r:d*p.r+b*v.r,g:d*p.g+b*v.g,b:d*p.b+b*v.b}}}y.exports=u},62264:(y,u,l)=>{"use strict";function p(n){return n==null}function v(n){return n!==null&&typeof n=="object"}function b(n){return n!==null&&typeof n=="object"}function d(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function c(n,t){return Array.from(new Set([...Object.keys(n),...Object.keys(t)])).reduce(((e,i)=>{let r=n[i],o=t[i];return b(r)&&b(o)?Object.assign(Object.assign({},e),{[i]:c(r,o)}):Object.assign(Object.assign({},e),{[i]:i in t?o:r})}),{})}function g(n){return!!v(n)&&"target"in n}l.d(u,{X6:()=>Jo});let f={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class w{static alreadyDisposed(){return new w({type:"alreadydisposed"})}static notBindable(){return new w({type:"notbindable"})}static notCompatible(t,e){return new w({type:"notcompatible",context:{id:`${t}.${e}`}})}static propertyNotFound(t){return new w({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new w({type:"shouldneverhappen"})}constructor(t){var e;this.message=(e=f[t.type](t.context))!==null&&e!==void 0?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}toString(){return this.message}}class C{constructor(t,e){this.obj_=t,this.key=e}static isBindable(t){return t!==null&&(typeof t=="object"||typeof t=="function")}read(){return this.obj_[this.key]}write(t){this.obj_[this.key]=t}writeProperty(t,e){let i=this.read();if(!C.isBindable(i))throw w.notBindable();if(!(t in i))throw w.propertyNotFound(t);i[t]=e}}class x{constructor(){this.observers_={}}on(t,e){let i=this.observers_[t];return i||(i=this.observers_[t]=[]),i.push({handler:e}),this}off(t,e){let i=this.observers_[t];return i&&(this.observers_[t]=i.filter((r=>r.handler!==e))),this}emit(t,e){let i=this.observers_[t];i&&i.forEach((r=>{r.handler(e)}))}}class R{constructor(t,e){var i;this.constraint_=e?.constraint,this.equals_=(i=e?.equals)!==null&&i!==void 0?i:(r,o)=>r===o,this.emitter=new x,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){let i=e??{forceEmit:!1,last:!0},r=this.constraint_?this.constraint_.constrain(t):t,o=this.rawValue_;(!this.equals_(o,r)||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=r,this.emitter.emit("change",{options:i,previousRawValue:o,rawValue:r,sender:this}))}}class O{constructor(t){this.emitter=new x,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){let i=e??{forceEmit:!1,last:!0},r=this.value_;(r!==t||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:this.value_,sender:this}))}}class ki{constructor(t){this.emitter=new x,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function S(n,t){let e=t?.constraint,i=t?.equals;return e||i?new R(n,t):new O(n)}class k{constructor(t){this.emitter=new x,this.valMap_=t;for(let e in this.valMap_)this.valMap_[e].emitter.on("change",(()=>{this.emitter.emit("change",{key:e,sender:this})}))}static createCore(t){return Object.keys(t).reduce(((e,i)=>Object.assign(e,{[i]:S(t[i])})),{})}static fromObject(t){let e=this.createCore(t);return new k(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}class Vt{constructor(t){this.values=k.fromObject({max:t.max,min:t.min})}constrain(t){let e=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(t,i),e)}}class Ei{constructor(t){this.values=k.fromObject({max:t.max,min:t.min})}constrain(t){let e=this.values.get("max"),i=this.values.get("min"),r=t;return p(i)||(r=Math.max(r,i)),p(e)||(r=Math.min(r,e)),r}}class Vi{constructor(t,e=0){this.step=t,this.origin=e}constrain(t){let e=this.origin%this.step;return e+Math.round((t-e)/this.step)*this.step}}class Li{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}let Si={"**":(n,t)=>Math.pow(n,t),"*":(n,t)=>n*t,"/":(n,t)=>n/t,"%":(n,t)=>n%t,"+":(n,t)=>n+t,"-":(n,t)=>n-t,"<<":(n,t)=>n<<t,">>":(n,t)=>n>>t,">>>":(n,t)=>n>>>t,"&":(n,t)=>n&t,"^":(n,t)=>n^t,"|":(n,t)=>n|t};class Mi{constructor(t,e,i){this.left=e,this.operator=t,this.right=i}evaluate(){let t=Si[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}let ji={"+":n=>n,"-":n=>-n,"~":n=>~n};class Oi{constructor(t,e){this.operator=t,this.expression=e}evaluate(){let t=ji[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function ce(n){return(t,e)=>{for(let i=0;i<n.length;i++){let r=n[i](t,e);if(r!=="")return r}return""}}function Lt(n,t){var e;let i=n.substr(t).match(/^\s+/);return(e=i&&i[0])!==null&&e!==void 0?e:""}function St(n,t){var e;let i=n.substr(t).match(/^[0-9]+/);return(e=i&&i[0])!==null&&e!==void 0?e:""}function de(n,t){let e=n.substr(t,1);if(t+=1,e.toLowerCase()!=="e")return"";let i=(function(r,o){let s=St(r,o);if(s!=="")return s;let a=r.substr(o,1);if(a!=="-"&&a!=="+")return"";let h=St(r,o+=1);return h===""?"":a+h})(n,t);return i===""?"":e+i}function Ye(n,t){let e=n.substr(t,1);if(e==="0")return e;let i=(function(r,o){let s=r.substr(o,1);return s.match(/^[1-9]$/)?s:""})(n,t);return t+=i.length,i===""?"":i+St(n,t)}let Ai=ce([function(n,t){let e=Ye(n,t);if(t+=e.length,e==="")return"";let i=n.substr(t,1);if(t+=i.length,i!==".")return"";let r=St(n,t);return e+i+r+de(n,t+=r.length)},function(n,t){let e=n.substr(t,1);if(t+=e.length,e!==".")return"";let i=St(n,t);return t+=i.length,i===""?"":e+i+de(n,t)},function(n,t){let e=Ye(n,t);return t+=e.length,e===""?"":e+de(n,t)}]),Di=ce([function(n,t){let e=n.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0b")return"";let i=(function(r,o){var s;let a=r.substr(o).match(/^[01]+/);return(s=a&&a[0])!==null&&s!==void 0?s:""})(n,t);return i===""?"":e+i},function(n,t){let e=n.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0o")return"";let i=(function(r,o){var s;let a=r.substr(o).match(/^[0-7]+/);return(s=a&&a[0])!==null&&s!==void 0?s:""})(n,t);return i===""?"":e+i},function(n,t){let e=n.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0x")return"";let i=(function(r,o){var s;let a=r.substr(o).match(/^[0-9a-f]+/i);return(s=a&&a[0])!==null&&s!==void 0?s:""})(n,t);return i===""?"":e+i}]),Ti=ce([Di,Ai]);function Ii(n,t,e){e+=Lt(t,e).length;let i=n.filter((r=>t.startsWith(r,e)))[0];return i?(e+=i.length,{cursor:e+=Lt(t,e).length,operator:i}):null}let Ni=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((n,t)=>(function(e,i){return(r,o)=>{let s=e(r,o);if(!s)return null;o=s.cursor;let a=s.evaluable;for(;;){let h=Ii(i,r,o);if(!h)break;o=h.cursor;let m=e(r,o);if(!m)return null;o=m.cursor,a=new Mi(h.operator,a,m.evaluable)}return a?{cursor:o,evaluable:a}:null}})(n,t)),(function n(t,e){let i=(function(s,a){var h;return(h=(function(m,_){let P=Ti(m,_);return _+=P.length,P===""?null:{evaluable:new Li(P),cursor:_}})(s,a))!==null&&h!==void 0?h:(function(m,_){let P=m.substr(_,1);if(_+=P.length,P!=="(")return null;let U=Xe(m,_);if(!U)return null;_=U.cursor,_+=Lt(m,_).length;let j=m.substr(_,1);return _+=j.length,j!==")"?null:{evaluable:U.evaluable,cursor:_}})(s,a)})(t,e);if(i)return i;let r=t.substr(e,1);if(e+=r.length,r!=="+"&&r!=="-"&&r!=="~")return null;let o=n(t,e);return o?{cursor:e=o.cursor,evaluable:new Oi(r,o.evaluable)}:null}));function Xe(n,t){return t+=Lt(n,t).length,Ni(n,t)}function G(n){var t;let e=(function(i){let r=Xe(i,0);return r?r.cursor+Lt(i,r.cursor).length!==i.length?null:r.evaluable:null})(n);return(t=e?.evaluate())!==null&&t!==void 0?t:null}function Qe(n){if(typeof n=="number")return n;if(typeof n=="string"){let t=G(n);if(!p(t))return t}return 0}function Ri(n){return String(n)}function I(n){return t=>t.toFixed(Math.max(Math.min(n,20),0))}function L(n,t,e,i,r){return i+(n-t)/(e-t)*(r-i)}function Ze(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function A(n,t,e){return Math.min(Math.max(n,t),e)}function Je(n,t){return(n%t+t)%t}function Bi(n,t){return p(n.step)?Math.max(Ze(t),2):Ze(n.step)}function tn(n){var t;return(t=n.step)!==null&&t!==void 0?t:1}function en(n,t){var e;let i=Math.abs((e=n.step)!==null&&e!==void 0?e:t);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function nn(n,t){return p(n.step)?null:new Vi(n.step,t)}function rn(n){return p(n.max)||p(n.min)?p(n.max)&&p(n.min)?null:new Ei({max:n.max,min:n.min}):new Vt({max:n.max,min:n.min})}function on(n,t){var e,i,r;return{formatter:(e=n.format)!==null&&e!==void 0?e:I(Bi(n,t)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:tn(n),pointerScale:(r=n.pointerScale)!==null&&r!==void 0?r:en(n,t)}}function sn(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function ue(n){return{constraint:n.constraint,textProps:k.fromObject(on(n.params,n.initialValue))}}class lt{constructor(t){this.controller=t}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(t){this.controller.viewProps.set("disabled",t)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(t){this.controller.viewProps.set("hidden",t)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(t){return this.controller.importState(t)}exportState(){return this.controller.exportState()}}class Gt{constructor(t){this.target=t}}class Mt extends Gt{constructor(t,e,i){super(t),this.value=e,this.last=i==null||i}}class zi extends Gt{constructor(t,e){super(t),this.expanded=e}}class Fi extends Gt{constructor(t,e){super(t),this.index=e}}class jt extends lt{constructor(t){super(t),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new x,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(t){this.controller.tag=t}on(t,e){let i=e.bind(this);return this.emitter_.on(t,(r=>{i(r)})),this}refresh(){this.controller.value.fetch()}onValueChange_(t){let e=this.controller.value;this.emitter_.emit("change",new Mt(this,e.binding.target.read(),t.options.last))}}class Ki{constructor(t,e){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e,this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new x}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,e){this.value_.setRawValue(t,e)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function W(n){return t=>e=>{if(!t&&e===void 0)return{succeeded:!1,value:void 0};if(t&&e===void 0)return{succeeded:!0,value:void 0};let i=n(e);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function an(n){return{custom:t=>W(t)(n),boolean:W((t=>typeof t=="boolean"?t:void 0))(n),number:W((t=>typeof t=="number"?t:void 0))(n),string:W((t=>typeof t=="string"?t:void 0))(n),function:W((t=>typeof t=="function"?t:void 0))(n),constant:t=>W((e=>e===t?t:void 0))(n),raw:W((t=>t))(n),object:t=>W((e=>{var i;if((i=e)!==null&&typeof i=="object")return(function(r,o){return Object.keys(o).reduce(((s,a)=>{if(s===void 0)return;let h=(0,o[a])(r[a]);return h.succeeded?Object.assign(Object.assign({},s),{[a]:h.value}):void 0}),{})})(e,t)}))(n),array:t=>W((e=>{var i;if(Array.isArray(e))return i=t,e.reduce(((r,o)=>{if(r===void 0)return;let s=i(o);return s.succeeded&&s.value!==void 0?[...r,s.value]:void 0}),[])}))(n)}}let he={optional:an(!0),required:an(!1)};function M(n,t){let e=t(he),i=he.required.object(e)(n);return i.succeeded?i.value:void 0}function B(n,t,e,i){if(t&&!t(n))return!1;let r=M(n,e);return!!r&&i(r)}function z(n,t){var e;return c((e=n?.())!==null&&e!==void 0?e:{},t)}function pt(n){return"value"in n}function ln(n){return!(!v(n)||!("binding"in n))&&g(n.binding)}let $="http://www.w3.org/2000/svg";function Wt(n){n.offsetHeight}function ve(n){return n.ontouchstart!==void 0}let Ui={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Yt(n,t){let e=n.createElementNS($,"svg");return e.innerHTML=Ui[t],e}function pn(n,t,e){n.insertBefore(t,n.children[e])}function me(n){n.parentElement&&n.parentElement.removeChild(n)}function cn(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function dn(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function Y(n,t){n.emitter.on("change",(e=>{t(e.rawValue)})),t(n.rawValue)}function q(n,t,e){Y(n.value(t),e)}let $i="tp";function E(n){return(t,e)=>[$i,"-",n,"v",t?`_${t}`:"",e?`-${e}`:""].join("")}let Ot=E("lbl");class un{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ot()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(Ot("l")),q(e.props,"label",(o=>{p(o)?this.element.classList.add(Ot(void 0,"nol")):(this.element.classList.remove(Ot(void 0,"nol")),(function(s){for(;s.childNodes.length>0;)s.removeChild(s.childNodes[0])})(i),i.appendChild((function(s,a){let h=s.createDocumentFragment();return a.split(`
`).map((m=>s.createTextNode(m))).forEach(((m,_)=>{_>0&&h.appendChild(s.createElement("br")),h.appendChild(m)})),h})(t,o)))})),this.element.appendChild(i),this.labelElement=i;let r=t.createElement("div");r.classList.add(Ot("v")),this.element.appendChild(r),this.valueElement=r}}class hn{constructor(t,e){this.props=e.props,this.valueController=e.valueController,this.viewProps=e.valueController.viewProps,this.view=new un(t,{props:e.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(t){return B(t,null,(e=>({label:e.optional.string})),(e=>(this.props.set("label",e.label),!0)))}exportProps(){return z(null,{label:this.props.get("label")})}}let vn=E(""),mn={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Xt{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;let e=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{["veryfirst","first","last","verylast"].forEach((i=>{e.classList.remove(vn(void 0,mn[i]))})),this.blade.get("positions").forEach((i=>{e.classList.add(vn(void 0,mn[i]))}))})),this.viewProps.handleDispose((()=>{me(e)}))}get parent(){return this.parent_}set parent(t){this.parent_=t,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(t){return B(t,null,(e=>({disabled:e.required.boolean,hidden:e.required.boolean})),(e=>(this.viewProps.importState(e),!0)))}exportState(){return z(null,Object.assign({},this.viewProps.exportState()))}}class ct extends Xt{constructor(t,e){if(e.value!==e.valueController.value)throw w.shouldNeverHappen();let i=e.valueController.viewProps,r=new hn(t,{blade:e.blade,props:e.props,valueController:e.valueController});super(Object.assign(Object.assign({},e),{view:new un(t,{props:e.props,viewProps:i}),viewProps:i})),this.labelController=r,this.value=e.value,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(t){return B(t,(e=>{var i,r,o;return super.importState(e)&&this.labelController.importProps(e)&&((o=(r=(i=this.valueController).importProps)===null||r===void 0?void 0:r.call(i,t))===null||o===void 0||o)}),(e=>({value:e.optional.raw})),(e=>(e.value&&(this.value.rawValue=e.value),!0)))}exportState(){var t,e,i;return z((()=>super.exportState()),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(i=(e=(t=this.valueController).exportProps)===null||e===void 0?void 0:e.call(t))!==null&&i!==void 0?i:{}))}}function bn(n){let t=Object.assign({},n);return delete t.value,t}class gn extends ct{constructor(t,e){super(t,e),this.tag=e.tag}importState(t){return B(t,(e=>super.importState(bn(t))),(e=>({tag:e.optional.string})),(e=>(this.tag=e.tag,!0)))}exportState(){return z((()=>bn(super.exportState())),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}class qi extends gn{importState(t){return B(t,(e=>super.importState(e)),(e=>({binding:e.required.object({value:e.required.raw})})),(e=>(this.value.binding.inject(e.binding.value),this.value.fetch(),!0)))}}function fn(n,t){for(;n.length<t;)n.push(void 0)}function Hi(n){let t=n.indexOf(void 0);return t<0?n:n.slice(0,t)}class Gi{constructor(t){this.emitter=new x,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t.binding,this.value_=S((function(e){let i=[];return fn(i,e),i})(t.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,e){this.value_.setRawValue(t,e)}fetch(){this.value_.rawValue=(function(t,e){let i=[...Hi(t),e];return i.length>t.length?i.splice(0,i.length-t.length):fn(i,t.length),i})(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}class Wi extends gn{exportState(){return z((()=>super.exportState()),{binding:{readonly:!0}})}}class Yi extends lt{get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get title(){var t;return(t=this.controller.buttonController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller.buttonController.props.set("title",t)}on(t,e){let i=e.bind(this);return this.controller.buttonController.emitter.on(t,(()=>{i(new Gt(this))})),this}}function mt(n,t){return e=>{(function(i,r,o){o?i.classList.add(r):i.classList.remove(r)})(n,t,e)}}function be(n,t){Y(n,(e=>{t.textContent=e??""}))}let ge=E("btn");class Xi{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ge()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("button");i.classList.add(ge("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;let r=t.createElement("div");r.classList.add(ge("t")),be(e.props.value("title"),r),this.buttonElement.appendChild(r)}}class Qi{constructor(t,e){this.emitter=new x,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new Xi(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(t){return B(t,null,(e=>({title:e.optional.string})),(e=>(this.props.set("title",e.title),!0)))}exportProps(){return z(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}}class wn extends Xt{constructor(t,e){let i=new Qi(t,{props:e.buttonProps,viewProps:e.viewProps}),r=new hn(t,{blade:e.blade,props:e.labelProps,valueController:i});super({blade:e.blade,view:r.view,viewProps:e.viewProps}),this.buttonController=i,this.labelController=r}importState(t){return B(t,(e=>super.importState(e)&&this.buttonController.importProps(e)&&this.labelController.importProps(e)),(()=>({})),(()=>!0))}exportState(){return z((()=>super.exportState()),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class _n{constructor(t){let[e,i]=t.split("-"),r=e.split(".");this.major=parseInt(r[0],10),this.minor=parseInt(r[1],10),this.patch=parseInt(r[2],10),this.prerelease=i??null}toString(){let t=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[t,this.prerelease].join("-"):t}}let bt=new _n("2.0.1");function D(n){return Object.assign({core:bt},n)}let Zi=D({id:"button",type:"blade",accept(n){let t=M(n,(e=>({title:e.required.string,view:e.required.constant("button"),label:e.optional.string})));return t?{params:t}:null},controller:n=>new wn(n.document,{blade:n.blade,buttonProps:k.fromObject({title:n.params.title}),labelProps:k.fromObject({label:n.params.label}),viewProps:n.viewProps}),api:n=>n.controller instanceof wn?new Yi(n.controller):null});class Ji{constructor(t,e){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=t,this.emitter_=new x,this.pool_=e,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map((t=>this.pool_.createApi(t)))}addBinding(t,e,i){let r=i??{},o=this.controller_.element.ownerDocument,s=this.pool_.createBinding(o,(function(h,m){if(!C.isBindable(h))throw w.notBindable();return new C(h,m)})(t,e),r),a=this.pool_.createBindingApi(s);return this.add(a,r.index)}addFolder(t){return(function(e,i){return e.addBlade(Object.assign(Object.assign({},i),{view:"folder"}))})(this,t)}addButton(t){return(function(e,i){return e.addBlade(Object.assign(Object.assign({},i),{view:"button"}))})(this,t)}addTab(t){return(function(e,i){return e.addBlade(Object.assign(Object.assign({},i),{view:"tab"}))})(this,t)}add(t,e){let i=t.controller;return this.controller_.rack.add(i,e),t}remove(t){this.controller_.rack.remove(t.controller)}addBlade(t){let e=this.controller_.element.ownerDocument,i=this.pool_.createBlade(e,t),r=this.pool_.createApi(i);return this.add(r,t.index)}on(t,e){let i=e.bind(this);return this.emitter_.on(t,(r=>{i(r)})),this}refresh(){this.children.forEach((t=>{var e;v(e=t)&&"refresh"in e&&typeof e.refresh=="function"&&t.refresh()}))}onRackValueChange_(t){let e=t.bladeController,i=this.pool_.createApi(e),r=ln(e.value)?e.value.binding:null;this.emitter_.emit("change",new Mt(i,r?r.target.read():e.value.rawValue,t.options.last))}}class fe extends lt{constructor(t,e){super(t),this.rackApi_=new Ji(t.rackController,e)}refresh(){this.rackApi_.refresh()}}class we extends Xt{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}importState(t){return B(t,(e=>super.importState(e)),(e=>({children:e.required.array(e.required.raw)})),(e=>this.rackController.rack.children.every(((i,r)=>i.importState(e.children[r])))))}exportState(){return z((()=>super.exportState()),{children:this.rackController.rack.children.map((t=>t.exportState()))})}}function _e(n){return"rackController"in n}class tr{constructor(t){this.emitter=new x,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(let e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw w.shouldNeverHappen();let i=e!==void 0?e:this.items_.length;this.items_.splice(i,0,t),this.cache_.add(t);let r=this.extract_(t);r&&(r.emitter.on("add",this.onSubListAdd_),r.emitter.on("remove",this.onSubListRemove_),r.allItems().forEach((o=>{this.cache_.add(o)}))),this.emitter.emit("add",{index:i,item:t,root:this,target:this})}remove(t){let e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);let i=this.extract_(t);i&&(i.allItems().forEach((r=>{this.cache_.delete(r)})),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}function er(n){return _e(n)?n.rackController.rack.bcSet_:null}class nr{constructor(t){var e,i;this.emitter=new x,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(e=t.blade)!==null&&e!==void 0?e:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=t.viewProps,this.bcSet_=new tr(er),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){var i;(i=t.parent)===null||i===void 0||i.remove(t),t.parent=this,this.bcSet_.add(t,e)}remove(t){t.parent=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(t)}onSetAdd_(t){this.updatePositions_();let e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,root:e,sender:this}),!e)return;let i=t.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),pt(i))i.value.emitter.on("change",this.onChildValueChange_);else if(_e(i)){let r=i.rackController.rack;if(r){let o=r.emitter;o.on("layout",this.onRackLayout_),o.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(t){this.updatePositions_();let e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,root:e,sender:this}),!e)return;let i=t.item;if(pt(i))i.value.emitter.off("change",this.onChildValueChange_);else if(_e(i)){let r=i.rackController.rack;if(r){let o=r.emitter;o.off("layout",this.onRackLayout_),o.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){let t=this.bcSet_.items.filter((r=>!r.viewProps.get("hidden"))),e=t[0],i=t[t.length-1];this.bcSet_.items.forEach((r=>{let o=[];r===e&&(o.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||o.push("veryfirst")),r===i&&(o.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||o.push("verylast")),r.blade.set("positions",o)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((t=>t.viewProps.get("disposed"))).forEach((t=>{this.bcSet_.remove(t)}))}onChildValueChange_(t){let e=(function(i,r){for(let o=0;o<i.length;o++){let s=i[o];if(pt(s)&&s.value===r)return s}return null})(this.find(pt),t.sender);if(!e)throw w.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:e,options:t.options,sender:this})}onRackLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(t){this.emitter.emit("valuechange",{bladeController:t.bladeController,options:t.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class xe{constructor(t){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=t.element,this.viewProps=t.viewProps;let e=new nr({blade:t.root?void 0:t.blade,viewProps:t.viewProps});e.emitter.on("add",this.onRackAdd_),e.emitter.on("remove",this.onRackRemove_),this.rack=e,this.viewProps.handleDispose((()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)}))}onRackAdd_(t){t.root&&pn(this.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.root&&me(t.bladeController.view.element)}}function gt(){return new k({positions:S([],{equals:d})})}class At extends k{constructor(t){super(t)}static create(t){let e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=k.createCore(e);return new At(i)}get styleExpanded(){var t;return(t=this.get("temporaryExpanded"))!==null&&t!==void 0?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";let t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!p(t)?`${t}px`:"auto"}bindExpandedClass(t,e){let i=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};q(this,"expanded",i),q(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function xn(n,t){t.style.height=n.styleHeight}function ye(n,t){n.value("expanded").emitter.on("beforechange",(()=>{if(n.set("completed",!1),p(n.get("expandedHeight"))){let e=(function(i,r){let o=0;return(function(s,a){let h=s.style.transition;s.style.transition="none",i.set("expandedHeight",null),i.set("temporaryExpanded",!0),Wt(r),o=r.clientHeight,i.set("temporaryExpanded",null),Wt(r),s.style.transition=h})(r),o})(n,t);e>0&&n.set("expandedHeight",e)}n.set("shouldFixHeight",!0),Wt(t)})),n.emitter.on("change",(()=>{xn(n,t)})),xn(n,t),t.addEventListener("transitionend",(e=>{e.propertyName==="height"&&n.cleanUpTransition()}))}class yn extends fe{constructor(t,e){super(t,e),this.emitter_=new x,this.controller.foldable.value("expanded").emitter.on("change",(i=>{this.emitter_.emit("fold",new zi(this,i.sender.rawValue))})),this.rackApi_.on("change",(i=>{this.emitter_.emit("change",i)}))}get expanded(){return this.controller.foldable.get("expanded")}set expanded(t){this.controller.foldable.set("expanded",t)}get title(){return this.controller.props.get("title")}set title(t){this.controller.props.set("title",t)}get children(){return this.rackApi_.children}addBinding(t,e,i){return this.rackApi_.addBinding(t,e,i)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){let i=e.bind(this);return this.emitter_.on(t,(r=>{i(r)})),this}}let Cn=E("cnt");class ir{constructor(t,e){var i;this.className_=E((i=e.viewName)!==null&&i!==void 0?i:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),Cn()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),q(this.foldable_,"completed",mt(this.element,this.className_(void 0,"cpl")));let r=t.createElement("button");r.classList.add(this.className_("b")),q(e.props,"title",(m=>{p(m)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),e.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;let o=t.createElement("div");o.classList.add(this.className_("i")),this.element.appendChild(o);let s=t.createElement("div");s.classList.add(this.className_("t")),be(e.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s;let a=t.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);let h=t.createElement("div");h.classList.add(this.className_("c")),this.element.appendChild(h),this.containerElement=h}}class Ce extends we{constructor(t,e){var i;let r=At.create((i=e.expanded)===null||i===void 0||i),o=new ir(t,{foldable:r,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new xe({blade:e.blade,element:o.containerElement,root:e.root,viewProps:e.viewProps}),view:o})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=r,ye(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",(()=>{this.foldable.cleanUpTransition()})),this.rackController.rack.emitter.on("remove",(()=>{this.foldable.cleanUpTransition()})),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(t){return B(t,(e=>super.importState(e)),(e=>({expanded:e.required.boolean,title:e.optional.string})),(e=>(this.foldable.set("expanded",e.expanded),this.props.set("title",e.title),!0)))}exportState(){return z((()=>super.exportState()),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}let rr=D({id:"folder",type:"blade",accept(n){let t=M(n,(e=>({title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean})));return t?{params:t}:null},controller:n=>new Ce(n.document,{blade:n.blade,expanded:n.params.expanded,props:k.fromObject({title:n.params.title}),viewProps:n.viewProps}),api:n=>n.controller instanceof Ce?new yn(n.controller,n.pool):null}),or=E("");function Pn(n,t){return mt(n,or(void 0,t))}class X extends k{constructor(t){var e,i;super(t),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=(i=S(this.getGlobalDisabled_()),[new ki(i),(r,o)=>{i.setRawValue(r,o)}]),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(e=this.get("parent"))===null||e===void 0||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(t){var e,i,r;let o=t??{};return new X(k.createCore({disabled:(e=o.disabled)!==null&&e!==void 0&&e,disposed:!1,hidden:(i=o.hidden)!==null&&i!==void 0&&i,parent:(r=o.parent)!==null&&r!==void 0?r:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(t){Y(this.globalDisabled_,Pn(t,"disabled")),q(this,"hidden",Pn(t,"hidden"))}bindDisabled(t){Y(this.globalDisabled_,(e=>{t.disabled=e}))}bindTabIndex(t){Y(this.globalDisabled_,(e=>{t.tabIndex=e?-1:0}))}handleDispose(t){this.value("disposed").emitter.on("change",(e=>{e&&t()}))}importState(t){this.set("disabled",t.disabled),this.set("hidden",t.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){let t=this.get("parent");return!!t&&t.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(t){var e;let i=t.previousRawValue;i?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(e=this.get("parent"))===null||e===void 0||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}let kn=E("tbp");class sr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(kn()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(kn("c")),this.element.appendChild(i),this.containerElement=i}}let Dt=E("tbi");class ar{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Dt()),e.viewProps.bindClassModifiers(this.element),q(e.props,"selected",(o=>{o?this.element.classList.add(Dt(void 0,"sel")):this.element.classList.remove(Dt(void 0,"sel"))}));let i=t.createElement("button");i.classList.add(Dt("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;let r=t.createElement("div");r.classList.add(Dt("t")),be(e.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r}}class lr{constructor(t,e){this.emitter=new x,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new ar(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Pe extends we{constructor(t,e){let i=new sr(t,{viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new xe({blade:e.blade,element:i.containerElement,viewProps:e.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new lr(t,{props:e.itemProps,viewProps:X.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=e.props,q(this.props,"selected",(r=>{this.itemController.props.set("selected",r),this.viewProps.set("hidden",!r)}))}get itemController(){return this.ic_}importState(t){return B(t,(e=>super.importState(e)),(e=>({selected:e.required.boolean,title:e.required.string})),(e=>(this.ic_.props.set("selected",e.selected),this.ic_.props.set("title",e.title),!0)))}exportState(){return z((()=>super.exportState()),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class pr extends fe{constructor(t,e){super(t,e),this.emitter_=new x,this.onSelect_=this.onSelect_.bind(this),this.pool_=e,this.rackApi_.on("change",(i=>{this.emitter_.emit("change",i)})),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(t){let e=this.controller.view.element.ownerDocument,i=new Pe(e,{blade:gt(),itemProps:k.fromObject({selected:!1,title:t.title}),props:k.fromObject({selected:!1}),viewProps:X.create()}),r=this.pool_.createApi(i);return this.rackApi_.add(r,t.index)}removePage(t){this.rackApi_.remove(this.rackApi_.children[t])}on(t,e){let i=e.bind(this);return this.emitter_.on(t,(r=>{i(r)})),this}onSelect_(t){this.emitter_.emit("select",new Fi(this,t.rawValue))}}class cr extends fe{get title(){var t;return(t=this.controller.itemController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller.itemController.props.set("title",t)}get selected(){return this.controller.props.get("selected")}set selected(t){this.controller.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBinding(t,e,i){return this.rackApi_.addBinding(t,e,i)}addBlade(t){return this.rackApi_.addBlade(t)}}class dr{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=S(!0),this.selectedIndex=S(-1),this.items_=[]}add(t,e){let i=e??this.items_.length;this.items_.splice(i,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){let e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);let t=this.items_.findIndex((e=>e.rawValue));t<0?(this.items_.forEach(((e,i)=>{e.rawValue=i===0})),this.selectedIndex.rawValue=0):(this.items_.forEach(((e,i)=>{e.rawValue=i===t})),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){let e=this.items_.findIndex((i=>i===t.sender));this.items_.forEach(((i,r)=>{i.rawValue=r===e})),this.selectedIndex.rawValue=e}else this.keepSelection_()}}let Tt=E("tab");class ur{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Tt(),Cn()),e.viewProps.bindClassModifiers(this.element),Y(e.empty,mt(this.element,Tt(void 0,"nop")));let i=t.createElement("div");i.classList.add(Tt("t")),this.element.appendChild(i),this.itemsElement=i;let r=t.createElement("div");r.classList.add(Tt("i")),this.element.appendChild(r);let o=t.createElement("div");o.classList.add(Tt("c")),this.element.appendChild(o),this.contentsElement=o}}class En extends we{constructor(t,e){let i=new dr,r=new ur(t,{empty:i.empty,viewProps:e.viewProps});super({blade:e.blade,rackController:new xe({blade:e.blade,element:r.contentsElement,viewProps:e.viewProps}),view:r}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);let o=this.rackController.rack;o.emitter.on("add",this.onRackAdd_),o.emitter.on("remove",this.onRackRemove_),this.tab=i}add(t,e){this.rackController.rack.add(t,e)}remove(t){this.rackController.rack.remove(this.rackController.rack.children[t])}onRackAdd_(t){if(!t.root)return;let e=t.bladeController;pn(this.view.itemsElement,e.itemController.view.element,t.index),e.itemController.viewProps.set("parent",this.viewProps),this.tab.add(e.props.value("selected"))}onRackRemove_(t){if(!t.root)return;let e=t.bladeController;me(e.itemController.view.element),e.itemController.viewProps.set("parent",null),this.tab.remove(e.props.value("selected"))}}let Vn=D({id:"tab",type:"blade",accept(n){let t=M(n,(e=>({pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")})));return t&&t.pages.length!==0?{params:t}:null},controller(n){let t=new En(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach((e=>{let i=new Pe(n.document,{blade:gt(),itemProps:k.fromObject({selected:!1,title:e.title}),props:k.fromObject({selected:!1}),viewProps:X.create()});t.add(i)})),t},api:n=>n.controller instanceof En?new pr(n.controller,n.pool):n.controller instanceof Pe?new cr(n.controller,n.pool):null});class ke extends jt{get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}}class hr{constructor(){this.disabled=!1,this.emitter=new x}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class vr{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new x,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;let t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;let t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class It{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce(((e,i)=>i.constrain(e)),t)}}function Qt(n,t){if(n instanceof t)return n;if(n instanceof It){let e=n.constraints.reduce(((i,r)=>i||(r instanceof t?r:null)),null);if(e)return e}return null}class Nt{constructor(t){this.values=k.fromObject({options:t})}constrain(t){let e=this.values.get("options");return e.length===0||e.filter((i=>i.value===t)).length>0?t:e[0].value}}function Rt(n){var t;let e=he;return Array.isArray(n)?(t=M({items:n},(i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))}))))===null||t===void 0?void 0:t.items:typeof n=="object"?e.required.raw(n).value:void 0}function Ee(n){if(Array.isArray(n))return n;let t=[];return Object.keys(n).forEach((e=>{t.push({text:e,value:n[e]})})),t}function Ve(n){return p(n)?null:new Nt(Ee(n))}let Le=E("lst");class mr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(Le()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("select");i.classList.add(Le("s")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;let r=t.createElement("div");r.classList.add(Le("m")),r.appendChild(Yt(t,"dropdown")),this.element.appendChild(r),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,q(this.props_,"options",(o=>{cn(this.selectElement),o.forEach((s=>{let a=t.createElement("option");a.textContent=s.text,this.selectElement.appendChild(a)})),this.update_()}))}update_(){let t=this.props_.get("options").map((e=>e.value));this.selectElement.selectedIndex=t.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class J{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new mr(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){let e=t.currentTarget;this.value.rawValue=this.props.get("options")[e.selectedIndex].value}importProps(t){return B(t,null,(e=>({options:e.required.custom(Rt)})),(e=>(this.props.set("options",Ee(e.options)),!0)))}exportProps(){return z(null,{options:this.props.get("options")})}}let Ln=E("pop");class br{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ln()),e.viewProps.bindClassModifiers(this.element),Y(e.shows,mt(this.element,Ln(void 0,"v")))}}class Sn{constructor(t,e){this.shows=S(!1),this.viewProps=e.viewProps,this.view=new br(t,{shows:this.shows,viewProps:this.viewProps})}}let Mn=E("txt");class gr{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Mn()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);let i=t.createElement("input");i.classList.add(Mn("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){let t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class Bt{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new gr(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){let e=t.currentTarget.value,i=this.parser_(e);p(i)||(this.value.rawValue=i),this.view.refresh()}}function jn(n){return n!=="false"&&!!n}function On(n){return(function(t){return String(t)})(n)}let fr=I(0);function Zt(n){return fr(n)+"%"}function An(n){return String(n)}function Se(n){return n}function ft({primary:n,secondary:t,forward:e,backward:i}){let r=!1;function o(s){r||(r=!0,s(),r=!1)}n.emitter.on("change",(s=>{o((()=>{t.setRawValue(e(n.rawValue,t.rawValue),s.options)}))})),t.emitter.on("change",(s=>{o((()=>{n.setRawValue(i(n.rawValue,t.rawValue),s.options)})),o((()=>{t.setRawValue(e(n.rawValue,t.rawValue),s.options)}))})),o((()=>{t.setRawValue(e(n.rawValue,t.rawValue),{forceEmit:!1,last:!0})}))}function N(n,t){let e=n*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+e:t.downKey?-e:0}function zt(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Q(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function Dn(n){return(function(t){return t==="ArrowUp"||t==="ArrowDown"})(n)||n==="ArrowLeft"||n==="ArrowRight"}function Me(n,t){var e,i;let r=t.ownerDocument.defaultView,o=t.getBoundingClientRect();return{x:n.pageX-(((e=r&&r.scrollX)!==null&&e!==void 0?e:0)+o.left),y:n.pageY-(((i=r&&r.scrollY)!==null&&i!==void 0?i:0)+o.top)}}class dt{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new x,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){let e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),(e=t.currentTarget)===null||e===void 0||e.focus();let i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(Me(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(Me(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){let e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(Me(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();let e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){let e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;let i=(e=t.targetTouches.item(0))!==null&&e!==void 0?e:this.lastTouch_,r=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(i?{x:i.clientX-r.left,y:i.clientY-r.top}:void 0),sender:this,shiftKey:t.shiftKey})}}let F=E("txt");class wr{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(F(),F(void 0,"num")),e.arrayPosition&&this.element.classList.add(F(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("input");i.classList.add(F("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(F()),this.inputElement.classList.add(F("i"));let r=t.createElement("div");r.classList.add(F("k")),this.element.appendChild(r),this.knobElement=r;let o=t.createElementNS($,"svg");o.classList.add(F("g")),this.knobElement.appendChild(o);let s=t.createElementNS($,"path");s.classList.add(F("gb")),o.appendChild(s),this.guideBodyElem_=s;let a=t.createElementNS($,"path");a.classList.add(F("gh")),o.appendChild(a),this.guideHeadElem_=a;let h=t.createElement("div");h.classList.add(E("tt")()),this.knobElement.appendChild(h),this.tooltipElem_=h,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(t.rawValue===null)return void this.element.classList.remove(F(void 0,"drg"));this.element.classList.add(F(void 0,"drg"));let e=t.rawValue/this.props_.get("pointerScale"),i=e+(e>0?-1:e<0?1:0),r=A(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+r},0 L${i},4 L${i+r},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);let o=this.props_.get("formatter");this.tooltipElem_.textContent=o(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){let t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class Ft{constructor(t,e){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=e.parser,this.props=e.props,this.sliderProps_=(i=e.sliderProps)!==null&&i!==void 0?i:null,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=S(null),this.view=new wr(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);let r=new dt(this.view.knobElement);r.emitter.on("down",this.onPointerDown_),r.emitter.on("move",this.onPointerMove_),r.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var e,i;let r=(e=this.sliderProps_)===null||e===void 0?void 0:e.get("min"),o=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max"),s=t;return r!==void 0&&(s=Math.max(s,r)),o!==void 0&&(s=Math.min(s,o)),s}onInputChange_(t){let e=t.currentTarget.value,i=this.parser_(e);p(i)||(this.value.rawValue=this.constrainValue_(i)),this.view.refresh()}onInputKeyDown_(t){let e=N(this.props.get("keyScale"),zt(t));e!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}onInputKeyUp_(t){N(this.props.get("keyScale"),zt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;let e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("pointerScale"))}onPointerMove_(t){let e=this.computeDraggingValue_(t.data);e!==null&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){let e=this.computeDraggingValue_(t.data);e!==null&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}let je=E("sld");class _r{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(je()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(je("t")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;let r=t.createElement("div");r.classList.add(je("k")),this.trackElement.appendChild(r),this.knobElement=r,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){let t=A(L(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class xr{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new _r(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new dt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(L(A(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("min"),this.props.get("max")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=N(this.props.get("keyScale"),Q(t));e!==0&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){N(this.props.get("keyScale"),Q(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}let Oe=E("sldtxt");class yr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Oe());let i=t.createElement("div");i.classList.add(Oe("s")),this.sliderView_=e.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);let r=t.createElement("div");r.classList.add(Oe("t")),this.textView_=e.textView,r.appendChild(this.textView_.element),this.element.appendChild(r)}}class Jt{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new xr(t,{props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new Ft(t,{parser:e.parser,props:e.textProps,sliderProps:e.sliderProps,value:e.value,viewProps:e.viewProps}),this.view=new yr(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(t){return B(t,null,(e=>({max:e.required.number,min:e.required.number})),(e=>{let i=this.sliderC_.props;return i.set("max",e.max),i.set("min",e.min),!0}))}exportProps(){let t=this.sliderC_.props;return z(null,{max:t.get("max"),min:t.get("min")})}}function Tn(n){return{sliderProps:new k({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new k({formatter:S(n.formatter),keyScale:n.keyScale,pointerScale:S(n.pointerScale)})}}let Cr={containerUnitSize:"cnt-usz"};function In(n){return`--${Cr[n]}`}function Kt(n){return sn(n)}function tt(n){if(b(n))return M(n,Kt)}function Z(n,t){if(!n)return;let e=[],i=nn(n,t);i&&e.push(i);let r=rn(n);return r&&e.push(r),new It(e)}function Nn(n){if(n==="inline"||n==="popup")return n}function Ut(n,t){n.write(t)}let te=E("ckb");class Pr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(te()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("label");i.classList.add(te("l")),this.element.appendChild(i);let r=t.createElement("input");r.classList.add(te("i")),r.type="checkbox",i.appendChild(r),this.inputElement=r,e.viewProps.bindDisabled(this.inputElement);let o=t.createElement("div");o.classList.add(te("w")),i.appendChild(o);let s=Yt(t,"check");o.appendChild(s),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class kr{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Pr(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){let e=t.currentTarget;this.value.rawValue=e.checked}}let Er=D({id:"input-bool",type:"input",accept:(n,t)=>{if(typeof n!="boolean")return null;let e=M(t,(i=>({options:i.optional.custom(Rt),readonly:i.optional.constant(!1)})));return e?{initialValue:n,params:e}:null},binding:{reader:n=>jn,constraint:n=>(function(t){let e=[],i=Ve(t.options);return i&&e.push(i),new It(e)})(n.params),writer:n=>Ut},controller:n=>{let t=n.document,e=n.value,i=n.constraint,r=i&&Qt(i,Nt);return r?new J(t,{props:new k({options:r.values.value("options")}),value:e,viewProps:n.viewProps}):new kr(t,{value:e,viewProps:n.viewProps})},api:n=>typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof J?new ke(n.controller):null}),ut=E("col");class Vr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ut()),e.foldable.bindExpandedClass(this.element,ut(void 0,"expanded")),q(e.foldable,"completed",mt(this.element,ut(void 0,"cpl")));let i=t.createElement("div");i.classList.add(ut("h")),this.element.appendChild(i);let r=t.createElement("div");r.classList.add(ut("s")),i.appendChild(r),this.swatchElement=r;let o=t.createElement("div");if(o.classList.add(ut("t")),i.appendChild(o),this.textElement=o,e.pickerLayout==="inline"){let s=t.createElement("div");s.classList.add(ut("p")),this.element.appendChild(s),this.pickerElement=s}else this.pickerElement=null}}function Rn(n,t,e){let i=Je(n,360),r=A(t/100,0,1),o=A(e/100,0,1),s=o*r,a=s*(1-Math.abs(i/60%2-1)),h=o-s,m,_,P;return[m,_,P]=i>=0&&i<60?[s,a,0]:i>=60&&i<120?[a,s,0]:i>=120&&i<180?[0,s,a]:i>=180&&i<240?[0,a,s]:i>=240&&i<300?[a,0,s]:[s,0,a],[255*(m+h),255*(_+h),255*(P+h)]}function H(n){return[n[0],n[1],n[2]]}function ee(n,t){return[n[0],n[1],n[2],t]}let Lr={hsl:{hsl:(n,t,e)=>[n,t,e],hsv:function(n,t,e){let i=e+t*(100-Math.abs(2*e-100))/200;return[n,i!==0?t*(100-Math.abs(2*e-100))/i:0,e+t*(100-Math.abs(2*e-100))/200]},rgb:function(n,t,e){let i=(n%360+360)%360,r=A(t/100,0,1),o=A(e/100,0,1),s=(1-Math.abs(2*o-1))*r,a=s*(1-Math.abs(i/60%2-1)),h=o-s/2,m,_,P;return[m,_,P]=i>=0&&i<60?[s,a,0]:i>=60&&i<120?[a,s,0]:i>=120&&i<180?[0,s,a]:i>=180&&i<240?[0,a,s]:i>=240&&i<300?[a,0,s]:[s,0,a],[255*(m+h),255*(_+h),255*(P+h)]}},hsv:{hsl:function(n,t,e){let i=100-Math.abs(e*(200-t)/100-100);return[n,i!==0?t*e/i:0,e*(200-t)/200]},hsv:(n,t,e)=>[n,t,e],rgb:Rn},rgb:{hsl:function(n,t,e){let i=A(n/255,0,1),r=A(t/255,0,1),o=A(e/255,0,1),s=Math.max(i,r,o),a=Math.min(i,r,o),h=s-a,m=0,_=0,P=(a+s)/2;return h!==0&&(_=h/(1-Math.abs(s+a-1)),m=i===s?(r-o)/h:r===s?2+(o-i)/h:4+(i-r)/h,m=m/6+(m<0?1:0)),[360*m,100*_,100*P]},hsv:function(n,t,e){let i=A(n/255,0,1),r=A(t/255,0,1),o=A(e/255,0,1),s=Math.max(i,r,o),a=s-Math.min(i,r,o),h;return h=a===0?0:s===i?((r-o)/a%6+6)%6*60:s===r?60*((o-i)/a+2):60*((i-r)/a+4),[h,100*(s===0?0:a/s),100*s]},rgb:(n,t,e)=>[n,t,e]}};function wt(n,t){return[t==="float"?1:n==="rgb"?255:360,t==="float"?1:n==="rgb"?255:100,t==="float"?1:n==="rgb"?255:100]}function Bn(n,t,e){var i;let r=wt(t,e);return[t==="rgb"?A(n[0],0,r[0]):(o=n[0],s=r[0],o===s?s:Je(o,s)),A(n[1],0,r[1]),A(n[2],0,r[2]),A((i=n[3])!==null&&i!==void 0?i:1,0,1)];var o,s}function zn(n,t,e,i){let r=wt(t,e),o=wt(t,i);return n.map(((s,a)=>s/r[a]*o[a]))}function Fn(n,t,e){let i=zn(n,t.mode,t.type,"int");return zn(Lr[t.mode][e.mode](...i),e.mode,"int",e.type)}class V{static black(){return new V([0,0,0],"rgb")}constructor(t,e){this.type="int",this.mode=e,this.comps_=Bn(t,e,this.type)}getComponents(t){return ee(Fn(H(this.comps_),{mode:this.mode,type:this.type},{mode:t??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){let t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}let et=E("colp");class Sr{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(et()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(et("hsv"));let r=t.createElement("div");r.classList.add(et("sv")),this.svPaletteView_=e.svPaletteView,r.appendChild(this.svPaletteView_.element),i.appendChild(r);let o=t.createElement("div");o.classList.add(et("h")),this.hPaletteView_=e.hPaletteView,o.appendChild(this.hPaletteView_.element),i.appendChild(o),this.element.appendChild(i);let s=t.createElement("div");if(s.classList.add(et("rgb")),this.textsView_=e.textsView,s.appendChild(this.textsView_.element),this.element.appendChild(s),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};let a=t.createElement("div");a.classList.add(et("a"));let h=t.createElement("div");h.classList.add(et("ap")),h.appendChild(this.alphaViews_.palette.element),a.appendChild(h);let m=t.createElement("div");m.classList.add(et("at")),m.appendChild(this.alphaViews_.text.element),a.appendChild(m),this.element.appendChild(a)}}get allFocusableElements(){let t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map((e=>e.inputElement))];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function Mr(n){return n==="int"?"int":n==="float"?"float":void 0}function Ae(n){return M(n,(t=>({color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(Mr)}),expanded:t.optional.boolean,picker:t.optional.custom(Nn),readonly:t.optional.constant(!1)})))}function ht(n){return n?.1:1}function Kn(n){var t;return(t=n.color)===null||t===void 0?void 0:t.type}class De{constructor(t,e){this.type="float",this.mode=e,this.comps_=Bn(t,e,this.type)}getComponents(t){return ee(Fn(H(this.comps_),{mode:this.mode,type:this.type},{mode:t??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){let t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}let jr={int:(n,t)=>new V(n,t),float:(n,t)=>new De(n,t)};function Te(n,t,e){return jr[e](n,t)}function T(n,t){if(n.type===t)return n;if((function(e){return e.type==="int"})(n)&&t==="float")return(function(e){let i=e.getComponents(),r=wt(e.mode,"int");return new De([L(i[0],0,r[0],0,1),L(i[1],0,r[1],0,1),L(i[2],0,r[2],0,1),i[3]],e.mode)})(n);if((function(e){return e.type==="float"})(n)&&t==="int")return(function(e){let i=e.getComponents(),r=wt(e.mode,"int");return new V([Math.round(L(i[0],0,1,0,r[0])),Math.round(L(i[1],0,1,0,r[1])),Math.round(L(i[2],0,1,0,r[2])),i[3]],e.mode)})(n);throw w.shouldNeverHappen()}function K(n,t){let e=n.match(/^(.+)%$/);return Math.min(e?.01*parseFloat(e[1])*t:parseFloat(n),t)}let Or={deg:n=>n,grad:n=>360*n/400,rad:n=>360*n/(2*Math.PI),turn:n=>360*n};function Un(n){let t=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(n);let e=parseFloat(t[1]),i=t[2];return Or[i](e)}function $n(n){let t=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;let e=[K(t[1],255),K(t[2],255),K(t[3],255)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function Ar(n){let t=$n(n);return t?new V(t,"rgb"):null}function qn(n){let t=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;let e=[K(t[1],255),K(t[2],255),K(t[3],255),K(t[4],1)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function Dr(n){let t=qn(n);return t?new V(t,"rgb"):null}function Hn(n){let t=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;let e=[Un(t[1]),K(t[2],100),K(t[3],100)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function Tr(n){let t=Hn(n);return t?new V(t,"hsl"):null}function Gn(n){let t=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;let e=[Un(t[1]),K(t[2],100),K(t[3],100),K(t[4],1)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function Ir(n){let t=Gn(n);return t?new V(t,"hsl"):null}function Wn(n){let t=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];let e=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null}function Nr(n){let t=Wn(n);return t?new V(t,"rgb"):null}function Yn(n){let t=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),L(parseInt(t[4]+t[4],16),0,255,0,1)];let e=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),L(parseInt(e[4],16),0,255,0,1)]:null}function Rr(n){let t=Yn(n);return t?new V(t,"rgb"):null}function Xn(n){let t=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;let e=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:e}function Qn(n){return t=>{let e=Xn(t);return e?Te(e,"rgb",n):null}}function Zn(n){let t=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;let e=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:e}function Jn(n){return t=>{let e=Zn(t);return e?Te(e,"rgb",n):null}}let Br=[{parser:Wn,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Yn,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:$n,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:qn,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Hn,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Gn,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Xn,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Zn,result:{alpha:!0,mode:"rgb",notation:"object"}}];function $t(n){let t=[Nr,Rr,Ar,Dr,Tr,Ir];n==="int"&&t.push(Qn("int"),Jn("int")),n==="float"&&t.push(Qn("float"),Jn("float"));let e=(function(i){return r=>i.reduce(((o,s)=>o!==null?o:s(r)),null)})(t);return i=>{let r=e(i);return r?T(r,n):null}}function zr(n){let t=$t("int");if(typeof n!="string")return V.black();let e=t(n);return e??V.black()}function ti(n){let t=A(Math.floor(n),0,255).toString(16);return t.length===1?`0${t}`:t}function Ie(n,t="#"){return`${t}${H(n.getComponents("rgb")).map(ti).join("")}`}function Ne(n,t="#"){let e=n.getComponents("rgb");return`${t}${[e[0],e[1],e[2],255*e[3]].map(ti).join("")}`}function ei(n){let t=I(0);return`rgb(${H(T(n,"int").getComponents("rgb")).map((e=>t(e))).join(", ")})`}function ne(n){let t=I(2),e=I(0);return`rgba(${T(n,"int").getComponents("rgb").map(((i,r)=>(r===3?t:e)(i))).join(", ")})`}function ni(n,t){let e=I(t==="float"?2:0),i=["r","g","b"];return`{${H(T(n,t).getComponents("rgb")).map(((r,o)=>`${i[o]}: ${e(r)}`)).join(", ")}}`}function Fr(n){return t=>ni(t,n)}function ii(n,t){let e=I(2),i=I(t==="float"?2:0),r=["r","g","b","a"];return`{${T(n,t).getComponents("rgb").map(((o,s)=>`${r[s]}: ${(s===3?e:i)(o)}`)).join(", ")}}`}function Kr(n){return t=>ii(t,n)}let Ur=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Ie},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Ne},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:ei},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:ne},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(n){let t=[I(0),Zt,Zt];return`hsl(${H(T(n,"int").getComponents("hsl")).map(((e,i)=>t[i](e))).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(n){let t=[I(0),Zt,Zt,I(2)];return`hsla(${T(n,"int").getComponents("hsl").map(((e,i)=>t[i](e))).join(", ")})`}},...["int","float"].reduce(((n,t)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:Fr(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:Kr(t)}]),[])];function ri(n){return Ur.reduce(((t,e)=>{return t||(i=e.format,r=n,i.alpha===r.alpha&&i.mode===r.mode&&i.notation===r.notation&&i.type===r.type?e.stringifier:null);var i,r}),null)}let qt=E("apl");class $r{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(qt()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let i=t.createElement("div");i.classList.add(qt("b")),this.element.appendChild(i);let r=t.createElement("div");r.classList.add(qt("c")),i.appendChild(r),this.colorElem_=r;let o=t.createElement("div");o.classList.add(qt("m")),this.element.appendChild(o),this.markerElem_=o;let s=t.createElement("div");s.classList.add(qt("p")),this.markerElem_.appendChild(s),this.previewElem_=s,this.update_()}update_(){let t=this.value.rawValue,e=t.getComponents("rgb"),i=new V([e[0],e[1],e[2],0],"rgb"),r=new V([e[0],e[1],e[2],255],"rgb"),o=["to right",ne(i),ne(r)];this.colorElem_.style.background=`linear-gradient(${o.join(",")})`,this.previewElem_.style.backgroundColor=ne(t);let s=L(e[3],0,1,0,100);this.markerElem_.style.left=`${s}%`}onValueChange_(){this.update_()}}class qr{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new $r(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new dt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let i=t.point.x/t.bounds.width,r=this.value.rawValue,[o,s,a]=r.getComponents("hsv");this.value.setRawValue(new V([o,s,a,i],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=N(ht(!0),Q(t));if(e===0)return;let i=this.value.rawValue,[r,o,s,a]=i.getComponents("hsv");this.value.setRawValue(new V([r,o,s,a+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){N(ht(!0),Q(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}let _t=E("coltxt");class Hr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(_t()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(_t("m")),this.modeElem_=(function(s){let a=s.createElement("select");return a.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}].reduce(((h,m)=>{let _=s.createElement("option");return _.textContent=m.text,_.value=m.value,h.appendChild(_),h}),s.createDocumentFragment())),a})(t),this.modeElem_.classList.add(_t("ms")),i.appendChild(this.modeSelectElement),e.viewProps.bindDisabled(this.modeElem_);let r=t.createElement("div");r.classList.add(_t("mm")),r.appendChild(Yt(t,"dropdown")),i.appendChild(r),this.element.appendChild(i);let o=t.createElement("div");o.classList.add(_t("w")),this.element.appendChild(o),this.inputsElem_=o,this.inputViews_=e.inputViews,this.applyInputViews_(),Y(e.mode,(s=>{this.modeElem_.value=s}))}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(t){this.inputViews_=t,this.applyInputViews_()}applyInputViews_(){cn(this.inputsElem_);let t=this.element.ownerDocument;this.inputViews_.forEach((e=>{let i=t.createElement("div");i.classList.add(_t("c")),i.appendChild(e.element),this.inputsElem_.appendChild(i)}))}}function Gr(n,t,e){let i=wt(n,t)[e];return new Vt({min:0,max:i})}class Wr{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=e.colorType,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=S(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new Hr(t,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){let e=this.colorMode.rawValue;return(function(i){return i!=="hex"})(e)?(function(i,r){let o={colorMode:r.colorMode,colorType:r.colorType,parser:G,viewProps:r.viewProps};return[0,1,2].map((s=>{let a=(function(h,m,_){return new Ft(h,{arrayPosition:_===0?"fst":_===2?"lst":"mid",parser:m.parser,props:k.fromObject({formatter:(P=m.colorType,I(P==="float"?2:0)),keyScale:ht(!1),pointerScale:m.colorType==="float"?.01:1}),value:S(0,{constraint:Gr(m.colorMode,m.colorType,_)}),viewProps:m.viewProps});var P})(i,o,s);return ft({primary:r.value,secondary:a.value,forward:h=>T(h,r.colorType).getComponents(r.colorMode)[s],backward(h,m){let _=r.colorMode,P=T(h,r.colorType).getComponents(_);return P[s]=m,T(Te(ee(H(P),P[3]),_,r.colorType),"int")}}),a}))})(t,{colorMode:e,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):(function(i,r){let o=new Bt(i,{parser:$t("int"),props:k.fromObject({formatter:Ie}),value:S(V.black()),viewProps:r.viewProps});return ft({primary:r.value,secondary:o.value,forward:s=>new V(H(s.getComponents()),s.mode),backward:(s,a)=>new V(ee(H(a.getComponents(s.mode)),s.getComponents()[3]),s.mode)}),[o]})(t,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(t){let e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map((i=>i.view))}}let Re=E("hpl");class Yr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Re()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let i=t.createElement("div");i.classList.add(Re("c")),this.element.appendChild(i);let r=t.createElement("div");r.classList.add(Re("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){let t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=ei(new V([e,100,100],"hsv"));let i=L(e,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}}class Xr{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Yr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new dt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let i=L(A(t.point.x,0,t.bounds.width),0,t.bounds.width,0,360),r=this.value.rawValue,[,o,s,a]=r.getComponents("hsv");this.value.setRawValue(new V([i,o,s,a],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){let e=N(ht(!1),Q(t));if(e===0)return;let i=this.value.rawValue,[r,o,s,a]=i.getComponents("hsv");this.value.setRawValue(new V([r+e,o,s,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){N(ht(!1),Q(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}let Be=E("svp");class Qr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Be()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);let i=t.createElement("canvas");i.height=64,i.width=64,i.classList.add(Be("c")),this.element.appendChild(i),this.canvasElement=i;let r=t.createElement("div");r.classList.add(Be("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){let t=(function(m){let _=m.ownerDocument.defaultView;return _&&"document"in _?m.getContext("2d",{willReadFrequently:!0}):null})(this.canvasElement);if(!t)return;let e=this.value.rawValue.getComponents("hsv"),i=this.canvasElement.width,r=this.canvasElement.height,o=t.getImageData(0,0,i,r),s=o.data;for(let m=0;m<r;m++)for(let _=0;_<i;_++){let P=L(_,0,i,0,100),U=L(m,0,r,100,0),j=Rn(e[0],P,U),ot=4*(m*i+_);s[ot]=j[0],s[ot+1]=j[1],s[ot+2]=j[2],s[ot+3]=255}t.putImageData(o,0,0);let a=L(e[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;let h=L(e[2],0,100,100,0);this.markerElem_.style.top=`${h}%`}onValueChange_(){this.update_()}}class Zr{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Qr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new dt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let i=L(t.point.x,0,t.bounds.width,0,100),r=L(t.point.y,0,t.bounds.height,100,0),[o,,,s]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new V([o,i,r,s],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){Dn(t.key)&&t.preventDefault();let[e,i,r,o]=this.value.rawValue.getComponents("hsv"),s=ht(!1),a=N(s,Q(t)),h=N(s,zt(t));a===0&&h===0||this.value.setRawValue(new V([e,i+a,r+h,o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){let e=ht(!1),i=N(e,Q(t)),r=N(e,zt(t));i===0&&r===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Jr{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new Xr(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Zr(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new qr(t,{value:this.value,viewProps:this.viewProps}),text:new Ft(t,{parser:G,props:k.fromObject({pointerScale:.01,keyScale:.1,formatter:I(2)}),value:S(0,{constraint:new Vt({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&ft({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,r)=>{let o=i.getComponents();return o[3]=r,new V(o,i.mode)}}),this.textsC_=new Wr(t,{colorType:e.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Sr(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}let ze=E("colsw");class to{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(ze()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(ze("sw")),this.element.appendChild(i),this.swatchElem_=i;let r=t.createElement("button");r.classList.add(ze("b")),e.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r,this.update_()}update_(){let t=this.value.rawValue;this.swatchElem_.style.backgroundColor=Ne(t)}onValueChange_(){this.update_()}}class eo{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new to(t,{value:this.value,viewProps:this.viewProps})}}class Fe{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=At.create(e.expanded),this.swatchC_=new eo(t,{value:this.value,viewProps:this.viewProps});let i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new Bt(t,{parser:e.parser,props:k.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Vr(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=e.pickerLayout==="popup"?new Sn(t,{viewProps:this.viewProps}):null;let r=new Jr(t,{colorType:e.colorType,supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach((o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=r,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(r.view.element),ft({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,s)=>s})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ye(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;let e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;let e=this.popC_.view.element,i=dn(t);i&&e.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!ve(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function no(n){return H(n.getComponents("rgb")).reduce(((t,e)=>t<<8|255&Math.floor(e)),0)}function io(n){return n.getComponents("rgb").reduce(((t,e,i)=>t<<8|255&Math.floor(i===3?255*e:e)),0)>>>0}function ro(n){return typeof n!="number"?V.black():new V([(t=n)>>16&255,t>>8&255,255&t],"rgb");var t}function oo(n){return typeof n!="number"?V.black():new V([(t=n)>>24&255,t>>16&255,t>>8&255,L(255&t,0,255,0,1)],"rgb");var t}function ie(n,t){return typeof n=="object"&&!p(n)&&t in n&&typeof n[t]=="number"}function oi(n){return ie(n,"r")&&ie(n,"g")&&ie(n,"b")}function si(n){return oi(n)&&ie(n,"a")}function ai(n){return oi(n)}function Ke(n,t){if(n.mode!==t.mode||n.type!==t.type)return!1;let e=n.getComponents(),i=t.getComponents();for(let r=0;r<e.length;r++)if(e[r]!==i[r])return!1;return!0}function li(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}let so=D({id:"input-color-number",type:"input",accept:(n,t)=>{if(typeof n!="number"||!(function(o){return"color"in o||o.view==="color"})(t))return null;let e=Ae(t);return e?{initialValue:n,params:Object.assign(Object.assign({},e),{supportsAlpha:(i=t,!!(!((r=i?.color)===null||r===void 0)&&r.alpha))})}:null;var i,r},binding:{reader:n=>n.params.supportsAlpha?oo:ro,equals:Ke,writer:n=>(function(t){let e=t?io:no;return(i,r)=>{Ut(i,e(r))}})(n.params.supportsAlpha)},controller:n=>{var t,e,i;return new Fe(n.document,{colorType:"int",expanded:(t=n.params.expanded)!==null&&t!==void 0&&t,formatter:(i=n.params.supportsAlpha,i?r=>Ne(r,"0x"):r=>Ie(r,"0x")),parser:$t("int"),pickerLayout:(e=n.params.picker)!==null&&e!==void 0?e:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function ao(n,t){return e=>n?ii(e,t):ni(e,t)}let lo=D({id:"input-color-object",type:"input",accept:(n,t)=>{var e;if(!ai(n))return null;let i=Ae(t);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(e=Kn(t))!==null&&e!==void 0?e:"int"})}:null},binding:{reader:n=>{return t=n.params.colorType,e=>{let i=(function(r,o){if(!ai(r))return T(V.black(),o);if(o==="int"){let s=li(r);return new V(s,"rgb")}if(o==="float"){let s=li(r);return new De(s,"rgb")}return T(V.black(),"int")})(e,t);return T(i,"int")};var t},equals:Ke,writer:n=>{return t=si(n.initialValue),e=n.params.colorType,(i,r)=>{t?(function(o,s,a){let h=T(s,a).toRgbaObject();o.writeProperty("r",h.r),o.writeProperty("g",h.g),o.writeProperty("b",h.b),o.writeProperty("a",h.a)})(i,r,e):(function(o,s,a){let h=T(s,a).toRgbaObject();o.writeProperty("r",h.r),o.writeProperty("g",h.g),o.writeProperty("b",h.b)})(i,r,e)};var t,e}},controller:n=>{var t,e;let i=si(n.initialValue);return new Fe(n.document,{colorType:n.params.colorType,expanded:(t=n.params.expanded)!==null&&t!==void 0&&t,formatter:ao(i,n.params.colorType),parser:$t("int"),pickerLayout:(e=n.params.picker)!==null&&e!==void 0?e:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}}),po=D({id:"input-color-string",type:"input",accept:(n,t)=>{if(typeof n!="string"||t.view==="text")return null;let e=(function(o,s="int"){let a=(function(h){return Br.reduce(((m,{parser:_,result:P})=>m||(_(h)?P:null)),null)})(o);return a?a.notation==="hex"&&s!=="float"?Object.assign(Object.assign({},a),{type:"int"}):a.notation==="func"?Object.assign(Object.assign({},a),{type:s}):null:null})(n,Kn(t));if(!e)return null;let i=ri(e);if(!i)return null;let r=Ae(t);return r?{initialValue:n,params:Object.assign(Object.assign({},r),{format:e,stringifier:i})}:null},binding:{reader:()=>zr,equals:Ke,writer:n=>{let t=(function(e){let i=ri(e);return i?(r,o)=>{Ut(r,i(o))}:null})(n.params.format);if(!t)throw w.notBindable();return t}},controller:n=>{var t,e;return new Fe(n.document,{colorType:n.params.format.type,expanded:(t=n.params.expanded)!==null&&t!==void 0&&t,formatter:n.params.stringifier,parser:$t("int"),pickerLayout:(e=n.params.picker)!==null&&e!==void 0?e:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});class Ue{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){let e=this.asm_.toComponents(t).map(((i,r)=>{var o,s;return(s=(o=this.components[r])===null||o===void 0?void 0:o.constrain(i))!==null&&s!==void 0?s:i}));return this.asm_.fromComponents(e)}}let pi=E("pndtxt");class co{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(pi()),this.textViews.forEach((i=>{let r=t.createElement("div");r.classList.add(pi("a")),r.appendChild(i.element),this.element.appendChild(r)}))}}class $e{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map(((i,r)=>(function(o,s,a){return new Ft(o,{arrayPosition:a===0?"fst":a===s.axes.length-1?"lst":"mid",parser:s.parser,props:s.axes[a].textProps,value:S(0,{constraint:s.axes[a].constraint}),viewProps:s.viewProps})})(t,e,r))),this.acs_.forEach(((i,r)=>{ft({primary:this.value,secondary:i.value,forward:o=>e.assembly.toComponents(o)[r],backward:(o,s)=>{let a=e.assembly.toComponents(o);return a[r]=s,e.assembly.fromComponents(a)}})})),this.view=new co(t,{textViews:this.acs_.map((i=>i.view))})}get textControllers(){return this.acs_}}class uo extends jt{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}}let ho=D({id:"input-number",type:"input",accept:(n,t)=>{if(typeof n!="number")return null;let e=M(t,(i=>Object.assign(Object.assign({},sn(i)),{options:i.optional.custom(Rt),readonly:i.optional.constant(!1)})));return e?{initialValue:n,params:e}:null},binding:{reader:n=>Qe,constraint:n=>(function(t,e){let i=[],r=nn(t,e);r&&i.push(r);let o=rn(t);o&&i.push(o);let s=Ve(t.options);return s&&i.push(s),new It(i)})(n.params,n.initialValue),writer:n=>Ut},controller:n=>{let t=n.value,e=n.constraint,i=e&&Qt(e,Nt);if(i)return new J(n.document,{props:new k({options:i.values.value("options")}),value:t,viewProps:n.viewProps});let r=on(n.params,t.rawValue),o=e&&Qt(e,Vt);return o?new Jt(n.document,Object.assign(Object.assign({},Tn(Object.assign(Object.assign({},r),{keyScale:S(r.keyScale),max:o.values.value("max"),min:o.values.value("min")}))),{parser:G,value:t,viewProps:n.viewProps})):new Ft(n.document,{parser:G,props:k.fromObject(r),value:t,viewProps:n.viewProps})},api:n=>typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof Jt?new uo(n.controller):n.controller.valueController instanceof J?new ke(n.controller):null});class nt{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(p(t))return!1;let e=t.x,i=t.y;return typeof e=="number"&&typeof i=="number"}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}let ci={toComponents:n=>n.getComponents(),fromComponents:n=>new nt(...n)},xt=E("p2d");class vo{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(xt()),e.viewProps.bindClassModifiers(this.element),Y(e.expanded,mt(this.element,xt(void 0,"expanded")));let i=t.createElement("div");i.classList.add(xt("h")),this.element.appendChild(i);let r=t.createElement("button");r.classList.add(xt("b")),r.appendChild(Yt(t,"p2dpad")),e.viewProps.bindDisabled(r),i.appendChild(r),this.buttonElement=r;let o=t.createElement("div");if(o.classList.add(xt("t")),i.appendChild(o),this.textElement=o,e.pickerLayout==="inline"){let s=t.createElement("div");s.classList.add(xt("p")),this.element.appendChild(s),this.pickerElement=s}else this.pickerElement=null}}let it=E("p2dp");class mo{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=t.createElement("div"),this.element.classList.add(it()),e.layout==="popup"&&this.element.classList.add(it(void 0,"p")),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("div");i.classList.add(it("p")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;let r=t.createElementNS($,"svg");r.classList.add(it("g")),this.padElement.appendChild(r),this.svgElem_=r;let o=t.createElementNS($,"line");o.classList.add(it("ax")),o.setAttributeNS(null,"x1","0"),o.setAttributeNS(null,"y1","50%"),o.setAttributeNS(null,"x2","100%"),o.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(o);let s=t.createElementNS($,"line");s.classList.add(it("ax")),s.setAttributeNS(null,"x1","50%"),s.setAttributeNS(null,"y1","0"),s.setAttributeNS(null,"x2","50%"),s.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(s);let a=t.createElementNS($,"line");a.classList.add(it("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;let h=t.createElement("div");h.classList.add(it("m")),this.padElement.appendChild(h),this.markerElem_=h,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){let[t,e]=this.value.rawValue.getComponents(),i=this.props_.get("max"),r=L(t,-i,+i,0,100),o=L(e,-i,+i,0,100),s=this.props_.get("invertsY")?100-o:o;this.lineElem_.setAttributeNS(null,"x2",`${r}%`),this.lineElem_.setAttributeNS(null,"y2",`${s}%`),this.markerElem_.style.left=`${r}%`,this.markerElem_.style.top=`${s}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function di(n,t,e){return[N(t[0],Q(n)),N(t[1],zt(n))*(e?1:-1)]}class bo{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new mo(t,{layout:e.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new dt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;let i=this.props.get("max"),r=L(t.point.x,0,t.bounds.width,-i,+i),o=L(this.props.get("invertsY")?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-i,+i);this.value.setRawValue(new nt(r,o),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){Dn(t.key)&&t.preventDefault();let[e,i]=di(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));e===0&&i===0||this.value.setRawValue(new nt(this.value.rawValue.x+e,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(t){let[e,i]=di(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));e===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class go{constructor(t,e){var i,r;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=At.create(e.expanded),this.popC_=e.pickerLayout==="popup"?new Sn(t,{viewProps:this.viewProps}):null;let o=new bo(t,{layout:e.pickerLayout,props:new k({invertsY:S(e.invertsY),max:S(e.max),xKeyScale:e.axes[0].textProps.value("keyScale"),yKeyScale:e.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});o.view.allFocusableElements.forEach((s=>{s.addEventListener("blur",this.onPopupChildBlur_),s.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=o,this.textC_=new $e(t,{assembly:ci,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new vo(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(r=this.view.buttonElement)===null||r===void 0||r.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),ft({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:s=>s,backward:(s,a)=>a})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ye(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(t){if(!this.popC_)return;let e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;let e=this.popC_.view.element,i=dn(t);i&&e.contains(i)||i&&i===this.view.buttonElement&&!ve(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.view.buttonElement.focus()}}function fo(n){return nt.isObject(n)?new nt(n.x,n.y):new nt}function wo(n,t){n.writeProperty("x",t.x),n.writeProperty("y",t.y)}function ui(n,t){var e,i;if(!p(n.min)||!p(n.max))return Math.max(Math.abs((e=n.min)!==null&&e!==void 0?e:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));let r=tn(n);return Math.max(10*Math.abs(r),10*Math.abs(t))}function _o(n,t){var e,i;let r=ui(c(n,(e=n.x)!==null&&e!==void 0?e:{}),t.x),o=ui(c(n,(i=n.y)!==null&&i!==void 0?i:{}),t.y);return Math.max(r,o)}function xo(n){if(!("y"in n))return!1;let t=n.y;return!!t&&"inverted"in t&&!!t.inverted}let yo=D({id:"input-point2d",type:"input",accept:(n,t)=>{if(!nt.isObject(n))return null;let e=M(t,(i=>Object.assign(Object.assign({},Kt(i)),{expanded:i.optional.boolean,picker:i.optional.custom(Nn),readonly:i.optional.constant(!1),x:i.optional.custom(tt),y:i.optional.object(Object.assign(Object.assign({},Kt(i)),{inverted:i.optional.boolean}))})));return e?{initialValue:n,params:e}:null},binding:{reader:()=>fo,constraint:n=>{return t=n.params,e=n.initialValue,new Ue({assembly:ci,components:[Z(Object.assign(Object.assign({},t),t.x),e.x),Z(Object.assign(Object.assign({},t),t.y),e.y)]});var t,e},equals:nt.equals,writer:()=>wo},controller:n=>{var t,e;let i=n.document,r=n.value,o=n.constraint,s=[n.params.x,n.params.y];return new go(i,{axes:r.rawValue.getComponents().map(((a,h)=>{var m;return ue({constraint:o.components[h],initialValue:a,params:c(n.params,(m=s[h])!==null&&m!==void 0?m:{})})})),expanded:(t=n.params.expanded)!==null&&t!==void 0&&t,invertsY:xo(n.params),max:_o(n.params,r.rawValue),parser:G,pickerLayout:(e=n.params.picker)!==null&&e!==void 0?e:"popup",value:r,viewProps:n.viewProps})}});class yt{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(p(t))return!1;let e=t.x,i=t.y,r=t.z;return typeof e=="number"&&typeof i=="number"&&typeof r=="number"}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}let hi={toComponents:n=>n.getComponents(),fromComponents:n=>new yt(...n)};function Co(n){return yt.isObject(n)?new yt(n.x,n.y,n.z):new yt}function Po(n,t){n.writeProperty("x",t.x),n.writeProperty("y",t.y),n.writeProperty("z",t.z)}let ko=D({id:"input-point3d",type:"input",accept:(n,t)=>{if(!yt.isObject(n))return null;let e=M(t,(i=>Object.assign(Object.assign({},Kt(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(tt),y:i.optional.custom(tt),z:i.optional.custom(tt)})));return e?{initialValue:n,params:e}:null},binding:{reader:n=>Co,constraint:n=>{return t=n.params,e=n.initialValue,new Ue({assembly:hi,components:[Z(Object.assign(Object.assign({},t),t.x),e.x),Z(Object.assign(Object.assign({},t),t.y),e.y),Z(Object.assign(Object.assign({},t),t.z),e.z)]});var t,e},equals:yt.equals,writer:n=>Po},controller:n=>{let t=n.value,e=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new $e(n.document,{assembly:hi,axes:t.rawValue.getComponents().map(((r,o)=>{var s;return ue({constraint:e.components[o],initialValue:r,params:c(n.params,(s=i[o])!==null&&s!==void 0?s:{})})})),parser:G,value:t,viewProps:n.viewProps})}});class Ct{constructor(t=0,e=0,i=0,r=0){this.x=t,this.y=e,this.z=i,this.w=r}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(p(t))return!1;let e=t.x,i=t.y,r=t.z,o=t.w;return typeof e=="number"&&typeof i=="number"&&typeof r=="number"&&typeof o=="number"}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}let vi={toComponents:n=>n.getComponents(),fromComponents:n=>new Ct(...n)};function Eo(n){return Ct.isObject(n)?new Ct(n.x,n.y,n.z,n.w):new Ct}function Vo(n,t){n.writeProperty("x",t.x),n.writeProperty("y",t.y),n.writeProperty("z",t.z),n.writeProperty("w",t.w)}let Lo=D({id:"input-point4d",type:"input",accept:(n,t)=>{if(!Ct.isObject(n))return null;let e=M(t,(i=>Object.assign(Object.assign({},Kt(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(tt),x:i.optional.custom(tt),y:i.optional.custom(tt),z:i.optional.custom(tt)})));return e?{initialValue:n,params:e}:null},binding:{reader:n=>Eo,constraint:n=>{return t=n.params,e=n.initialValue,new Ue({assembly:vi,components:[Z(Object.assign(Object.assign({},t),t.x),e.x),Z(Object.assign(Object.assign({},t),t.y),e.y),Z(Object.assign(Object.assign({},t),t.z),e.z),Z(Object.assign(Object.assign({},t),t.w),e.w)]});var t,e},equals:Ct.equals,writer:n=>Vo},controller:n=>{let t=n.value,e=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new $e(n.document,{assembly:vi,axes:t.rawValue.getComponents().map(((r,o)=>{var s;return ue({constraint:e.components[o],initialValue:r,params:c(n.params,(s=i[o])!==null&&s!==void 0?s:{})})})),parser:G,value:t,viewProps:n.viewProps})}}),So=D({id:"input-string",type:"input",accept:(n,t)=>{if(typeof n!="string")return null;let e=M(t,(i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Rt)})));return e?{initialValue:n,params:e}:null},binding:{reader:n=>An,constraint:n=>(function(t){let e=[],i=Ve(t.options);return i&&e.push(i),new It(e)})(n.params),writer:n=>Ut},controller:n=>{let t=n.document,e=n.value,i=n.constraint,r=i&&Qt(i,Nt);return r?new J(t,{props:new k({options:r.values.value("options")}),value:e,viewProps:n.viewProps}):new Bt(t,{parser:o=>o,props:k.fromObject({formatter:Se}),value:e,viewProps:n.viewProps})},api:n=>typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof J?new ke(n.controller):null}),Mo=200,re=3,mi=E("mll");class jo{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(mi()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("textarea");i.classList.add(mi("i")),i.style.height=`calc(var(${In("containerUnitSize")}) * ${e.rows})`,i.readOnly=!0,e.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){let t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,i=[];this.value.rawValue.forEach((r=>{r!==void 0&&i.push(this.formatter_(r))})),t.textContent=i.join(`
`),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class qe{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new jo(t,{formatter:e.formatter,rows:e.rows,value:this.value,viewProps:this.viewProps})}}let bi=E("sgl");class Oo{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(bi()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("input");i.classList.add(bi("i")),i.readOnly=!0,i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){let t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=e!==void 0?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class He{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Oo(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}let Ao=D({id:"monitor-bool",type:"monitor",accept:(n,t)=>{if(typeof n!="boolean")return null;let e=M(t,(i=>({readonly:i.required.constant(!0),rows:i.optional.number})));return e?{initialValue:n,params:e}:null},binding:{reader:n=>jn},controller:n=>{var t;return n.value.rawValue.length===1?new He(n.document,{formatter:On,value:n.value,viewProps:n.viewProps}):new qe(n.document,{formatter:On,rows:(t=n.params.rows)!==null&&t!==void 0?t:re,value:n.value,viewProps:n.viewProps})}});class Do extends jt{get max(){return this.controller.valueController.props.get("max")}set max(t){this.controller.valueController.props.set("max",t)}get min(){return this.controller.valueController.props.get("min")}set min(t){this.controller.valueController.props.set("min",t)}}let rt=E("grl");class To{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(rt()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.props_=e.props,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);let i=t.createElementNS($,"svg");i.classList.add(rt("g")),i.style.height=`calc(var(${In("containerUnitSize")}) * ${e.rows})`,this.element.appendChild(i),this.svgElem_=i;let r=t.createElementNS($,"polyline");this.svgElem_.appendChild(r),this.lineElem_=r;let o=t.createElement("div");o.classList.add(rt("t"),E("tt")()),this.element.appendChild(o),this.tooltipElem_=o,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){let t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,i=this.props_.get("min"),r=this.props_.get("max"),o=[];this.value.rawValue.forEach(((_,P)=>{if(_===void 0)return;let U=L(P,0,e,0,t.width),j=L(_,i,r,t.height,0);o.push([U,j].join(","))})),this.lineElem_.setAttributeNS(null,"points",o.join(" "));let s=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(a===void 0)return void s.classList.remove(rt("t","a"));let h=L(this.cursor_.rawValue,0,e,0,t.width),m=L(a,i,r,t.height,0);s.style.left=`${h}px`,s.style.top=`${m}px`,s.textContent=`${this.formatter_(a)}`,s.classList.contains(rt("t","a"))||(s.classList.add(rt("t","a"),rt("t","in")),Wt(s),s.classList.remove(rt("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class gi{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.cursor_=S(-1),this.view=new To(t,{cursor:this.cursor_,formatter:e.formatter,rows:e.rows,props:this.props,value:this.value,viewProps:this.viewProps}),ve(t)){let i=new dt(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}importProps(t){return B(t,null,(e=>({max:e.required.number,min:e.required.number})),(e=>(this.props.set("max",e.max),this.props.set("min",e.min),!0)))}exportProps(){return z(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){let e=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(L(t.offsetX,0,e.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){t.data.point?this.cursor_.rawValue=Math.floor(L(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Ge(n){return p(n.format)?I(2):n.format}function fi(n){return n.view==="graph"}let Io=D({id:"monitor-number",type:"monitor",accept:(n,t)=>{if(typeof n!="number")return null;let e=M(t,(i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string})));return e?{initialValue:n,params:e}:null},binding:{defaultBufferSize:n=>fi(n)?64:1,reader:n=>Qe},controller:n=>fi(n.params)?(function(t){var e,i,r;return new gi(t.document,{formatter:Ge(t.params),rows:(e=t.params.rows)!==null&&e!==void 0?e:re,props:k.fromObject({max:(i=t.params.max)!==null&&i!==void 0?i:100,min:(r=t.params.min)!==null&&r!==void 0?r:0}),value:t.value,viewProps:t.viewProps})})(n):(function(t){var e;return t.value.rawValue.length===1?new He(t.document,{formatter:Ge(t.params),value:t.value,viewProps:t.viewProps}):new qe(t.document,{formatter:Ge(t.params),rows:(e=t.params.rows)!==null&&e!==void 0?e:re,value:t.value,viewProps:t.viewProps})})(n),api:n=>n.controller.valueController instanceof gi?new Do(n.controller):null}),No=D({id:"monitor-string",type:"monitor",accept:(n,t)=>{if(typeof n!="string")return null;let e=M(t,(i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number})));return e?{initialValue:n,params:e}:null},binding:{reader:n=>An},controller:n=>{var t;let e=n.value;return e.rawValue.length>1||n.params.multiline?new qe(n.document,{formatter:Se,rows:(t=n.params.rows)!==null&&t!==void 0?t:re,value:e,viewProps:n.viewProps}):new He(n.document,{formatter:Se,value:e,viewProps:n.viewProps})}});class Ro{constructor(t){this.target=t.target,this.reader_=t.reader,this.writer_=t.writer}read(){return this.reader_(this.target.read())}write(t){this.writer_(this.target,t)}inject(t){this.write(this.reader_(t))}}class Bo{constructor(t){this.target=t.target,this.reader_=t.reader}read(){return this.reader_(this.target.read())}}class zo{constructor(t){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=t}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t,e){if(!(i=e.core)||i.major!==bt.major)throw w.notCompatible(t,e.id);var i;e.type==="blade"?this.pluginsMap_.blades.unshift(e):e.type==="input"?this.pluginsMap_.inputs.unshift(e):e.type==="monitor"&&this.pluginsMap_.monitors.unshift(e)}createInput_(t,e,i){return this.pluginsMap_.inputs.reduce(((r,o)=>r??(function(s,a){var h;let m=s.accept(a.target.read(),a.params);if(p(m))return null;let _={target:a.target,initialValue:m.initialValue,params:m.params},P=M(a.params,(vt=>({disabled:vt.optional.boolean,hidden:vt.optional.boolean,label:vt.optional.string,tag:vt.optional.string}))),U=s.binding.reader(_),j=s.binding.constraint?s.binding.constraint(_):void 0,ot=new Ro({reader:U,target:a.target,writer:s.binding.writer(_)}),oe=new Ki(S(U(m.initialValue),{constraint:j,equals:s.binding.equals}),ot),Pt=s.controller({constraint:j,document:a.document,initialValue:m.initialValue,params:m.params,value:oe,viewProps:X.create({disabled:P?.disabled,hidden:P?.hidden})});return new qi(a.document,{blade:gt(),props:k.fromObject({label:"label"in a.params?(h=P?.label)!==null&&h!==void 0?h:null:a.target.key}),tag:P?.tag,value:oe,valueController:Pt})})(o,{document:t,target:e,params:i})),null)}createMonitor_(t,e,i){return this.pluginsMap_.monitors.reduce(((r,o)=>r??(function(s,a){var h,m,_;let P=s.accept(a.target.read(),a.params);if(p(P))return null;let U={target:a.target,initialValue:P.initialValue,params:P.params},j=M(a.params,(Ht=>({bufferSize:Ht.optional.number,disabled:Ht.optional.boolean,hidden:Ht.optional.boolean,interval:Ht.optional.number,label:Ht.optional.string}))),ot=s.binding.reader(U),oe=(m=(h=j?.bufferSize)!==null&&h!==void 0?h:s.binding.defaultBufferSize&&s.binding.defaultBufferSize(P.params))!==null&&m!==void 0?m:1,Pt=new Gi({binding:new Bo({reader:ot,target:a.target}),bufferSize:oe,ticker:(vt=a.document,se=j?.interval,se===0?new hr:new vr(vt,se??Mo))});var vt,se;let We=s.controller({document:a.document,params:P.params,value:Pt,viewProps:X.create({disabled:j?.disabled,hidden:j?.hidden})});return We.viewProps.bindDisabled(Pt.ticker),We.viewProps.handleDispose((()=>{Pt.ticker.dispose()})),new Wi(a.document,{blade:gt(),props:k.fromObject({label:"label"in a.params?(_=j?.label)!==null&&_!==void 0?_:null:a.target.key}),value:Pt,valueController:We})})(o,{document:t,params:i,target:e})),null)}createBinding(t,e,i){if(p(e.read()))throw new w({context:{key:e.key},type:"nomatchingcontroller"});let r=this.createInput_(t,e,i);if(r)return r;let o=this.createMonitor_(t,e,i);if(o)return o;throw new w({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){let i=this.pluginsMap_.blades.reduce(((r,o)=>r??(function(s,a){let h=s.accept(a.params);if(!h)return null;let m=M(a.params,(_=>({disabled:_.optional.boolean,hidden:_.optional.boolean})));return s.controller({blade:gt(),document:a.document,params:Object.assign(Object.assign({},h.params),{disabled:m?.disabled,hidden:m?.hidden}),viewProps:X.create({disabled:m?.disabled,hidden:m?.hidden})})})(o,{document:t,params:e})),null);if(!i)throw new w({type:"nomatchingview",context:{params:e}});return i}createInputBindingApi_(t){let e=this.pluginsMap_.inputs.reduce(((i,r)=>{var o,s;return i||((s=(o=r.api)===null||o===void 0?void 0:o.call(r,{controller:t}))!==null&&s!==void 0?s:null)}),null);return this.apiCache_.add(t,e??new jt(t))}createMonitorBindingApi_(t){let e=this.pluginsMap_.monitors.reduce(((i,r)=>{var o,s;return i||((s=(o=r.api)===null||o===void 0?void 0:o.call(r,{controller:t}))!==null&&s!==void 0?s:null)}),null);return this.apiCache_.add(t,e??new jt(t))}createBindingApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if((function(e){return pt(e)&&(function(i){if(!("binding"in i))return!1;let r=i.binding;return g(r)&&"read"in r&&"write"in r})(e.value)})(t))return this.createInputBindingApi_(t);if((function(e){return pt(e)&&(function(i){if(!("binding"in i))return!1;let r=i.binding;return g(r)&&"read"in r&&!("write"in r)})(e.value)})(t))return this.createMonitorBindingApi_(t);throw w.shouldNeverHappen()}createApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if((function(i){return pt(i)&&ln(i.value)})(t))return this.createBindingApi(t);let e=this.pluginsMap_.blades.reduce(((i,r)=>i??r.api({controller:t,pool:this})),null);if(!e)throw w.shouldNeverHappen();return this.apiCache_.add(t,e)}}let Fo=new class{constructor(){this.map_=new Map}get(n){var t;return(t=this.map_.get(n))!==null&&t!==void 0?t:null}has(n){return this.map_.has(n)}add(n,t){return this.map_.set(n,t),n.viewProps.handleDispose((()=>{this.map_.delete(n)})),t}};class Ko extends lt{constructor(t){super(t),this.emitter_=new x,this.controller.value.emitter.on("change",(e=>{this.emitter_.emit("change",new Mt(this,e.rawValue))}))}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){let i=e.bind(this);return this.emitter_.on(t,(r=>{i(r)})),this}}class Uo extends lt{}class $o extends lt{constructor(t){super(t),this.emitter_=new x,this.controller.value.emitter.on("change",(e=>{this.emitter_.emit("change",new Mt(this,e.rawValue))}))}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){let i=e.bind(this);return this.emitter_.on(t,(r=>{i(r)})),this}}class qo extends lt{constructor(t){super(t),this.emitter_=new x,this.controller.value.emitter.on("change",(e=>{this.emitter_.emit("change",new Mt(this,e.rawValue))}))}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(t){this.controller.valueController.props.set("formatter",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){let i=e.bind(this);return this.emitter_.on(t,(r=>{i(r)})),this}}let Ho={id:"list",type:"blade",core:bt,accept(n){let t=M(n,(e=>({options:e.required.custom(Rt),value:e.required.raw,view:e.required.constant("list"),label:e.optional.string})));return t?{params:t}:null},controller(n){let t=new Nt(Ee(n.params.options)),e=S(n.params.value,{constraint:t}),i=new J(n.document,{props:new k({options:t.values.value("options")}),value:e,viewProps:n.viewProps});return new ct(n.document,{blade:n.blade,props:k.fromObject({label:n.params.label}),value:e,valueController:i})},api:n=>n.controller instanceof ct&&n.controller.valueController instanceof J?new Ko(n.controller):null};class Go extends yn{constructor(t,e){super(t,e)}get element(){return this.controller.view.element}}class Wo extends Ce{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}}let wi=E("spr");class Yo{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(wi()),e.viewProps.bindClassModifiers(this.element);let i=t.createElement("hr");i.classList.add(wi("r")),this.element.appendChild(i)}}class _i extends Xt{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new Yo(t,{viewProps:e.viewProps})}))}}let Xo={id:"separator",type:"blade",core:bt,accept(n){let t=M(n,(e=>({view:e.required.constant("separator")})));return t?{params:t}:null},controller:n=>new _i(n.document,{blade:n.blade,viewProps:n.viewProps}),api:n=>n.controller instanceof _i?new Uo(n.controller):null},Qo={id:"slider",type:"blade",core:bt,accept(n){let t=M(n,(e=>({max:e.required.number,min:e.required.number,view:e.required.constant("slider"),format:e.optional.function,label:e.optional.string,value:e.optional.number})));return t?{params:t}:null},controller(n){var t,e;let i=(t=n.params.value)!==null&&t!==void 0?t:0,r=new Vt({max:n.params.max,min:n.params.min}),o=S(i,{constraint:r}),s=new Jt(n.document,Object.assign(Object.assign({},Tn({formatter:(e=n.params.format)!==null&&e!==void 0?e:Ri,keyScale:S(1),max:r.values.value("max"),min:r.values.value("min"),pointerScale:en(n.params,i)})),{parser:G,value:o,viewProps:n.viewProps}));return new ct(n.document,{blade:n.blade,props:k.fromObject({label:n.params.label}),value:o,valueController:s})},api:n=>n.controller instanceof ct&&n.controller.valueController instanceof Jt?new $o(n.controller):null},Zo={id:"text",type:"blade",core:bt,accept(n){let t=M(n,(e=>({parse:e.required.function,value:e.required.raw,view:e.required.constant("text"),format:e.optional.function,label:e.optional.string})));return t?{params:t}:null},controller(n){var t;let e=S(n.params.value),i=new Bt(n.document,{parser:n.params.parse,props:k.fromObject({formatter:(t=n.params.format)!==null&&t!==void 0?t:r=>String(r)}),value:e,viewProps:n.viewProps});return new ct(n.document,{blade:n.blade,props:k.fromObject({label:n.params.label}),value:e,valueController:i})},api:n=>n.controller instanceof ct&&n.controller.valueController instanceof Bt?new qo(n.controller):null};class Jo extends Go{constructor(t){var e,i;let r=t??{},o=(e=r.document)!==null&&e!==void 0?e:globalThis.document,s=(function(){let a=new zo(Fo);return[yo,ko,Lo,So,ho,po,lo,so,Er,Ao,No,Io,Zi,rr,Vn].forEach((h=>{a.register("core",h)})),a})();super(new Wo(o,{expanded:r.expanded,blade:gt(),props:k.fromObject({title:r.title}),viewProps:X.create()}),s),this.pool_=s,this.containerElem_=(i=r.container)!==null&&i!==void 0?i:(function(a){let h=a.createElement("div");return h.classList.add(E("dfw")()),a.body&&a.body.appendChild(h),h})(o),this.containerElem_.appendChild(this.element),this.doc_=o,this.usesDefaultWrapper_=!r.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw w.alreadyDisposed();return this.doc_}dispose(){let t=this.containerElem_;if(!t)throw w.alreadyDisposed();if(this.usesDefaultWrapper_){let e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){t.css&&(function(e,i,r){if(e.querySelector(`style[data-tp-style=${i}]`))return;let o=e.createElement("style");o.dataset.tpStyle=i,o.textContent=r,e.head.appendChild(o)})(this.document,`plugin-${t.id}`,t.css),("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach((e=>{this.pool_.register(t.id,e)}))}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1 * var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(		2px * 2 + var(--cnt-usz) + var(--cnt-hp)	);position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(		var(--cnt-hp) + (				var(--cnt-usz) + 4px - 6px			) / 2 - 2px	);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1 * var(--cnt-hp));right:calc(-1 * var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(			var(--cnt-vp) + 2px		);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1 * var(--cnt-hp));position:absolute;right:calc(-1 * var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz) * 3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz) * 3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1 * var(--cnt-hp));right:calc(-1 * var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(			var(--bld-hp) - 5px		);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(			2px * 2 + var(--cnt-usz) + var(--cnt-hp)		);text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1 * var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1 * var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[Ho,Xo,Qo,Vn,Zo]})}}new _n("4.0.1")}}])}(function(y){if(y.extensions.unsandboxed===!1)throw new Error("This extension must run unsandboxed");class u{extensionLoader;vmToJSON;vm;constructor(p){this.vm=p,this.extensionLoader=new le,this.vmToJSON=new pe,Ci(this.vm,this.vmToJSON),this.setTempext(this),typeof window.webpackChunkscratch_extensions>"u"&&(window.webpackChunkscratch_extensions=this.extensionLoader),Pi()}getInfo(){return{id:"extensionWrapper",name:"Wrapper",color1:"#4285F4",color2:"#2855C1",blocks:[{opcode:"extensionKeeper",blockType:y.BlockType.COMMAND,text:Et("ccwpolyfill.extensionKeeper")}]}}extensionKeeper(){}setTempext(p){if(typeof window.tempExt>"u"){let v={};Object.defineProperty(window,"tempExt",{get(){return v},set(b){if(typeof b<"u"&&typeof b.Extension=="function"){v=b;let d,c;try{d=new b.Extension(p.vm);let g=p.extensionLoader.createProxiedFunctions(d);c=d.getInfo(),g.getInfo=()=>{let f=c.blocks;if(typeof f=="object"&&f!==null)for(let[w,C]of Object.entries(f))typeof C=="string"&&C.startsWith("---")&&C.length!==3&&(f[w]={blockType:"label",text:C.substring(3)});return/^[a-z0-9]+$/i.test(c.id)||(c.id=c.id.replace(/[^a-zA-Z0-9]/g,"")),c},Scratch.extensions.register(g),this.vm.runtime[`ext_${c.id}`]=d}catch(g){console.warn("[CCW Polyfill] First Method failed...",g);try{let f=p.extensionLoader.convertBlocks(c.blocks);d._______ccw_polyfill__temp=()=>"__ccw_polyfill";let w=p.extensionLoader.createProxiedFunctions(d);w.getInfo=function(){let C=d.getInfo.call(this),x=C.blocks;if(typeof x=="object"&&x!==null)for(let[R,O]of Object.entries(x))typeof O=="string"&&O.startsWith("---")&&O.length!==3&&(x[R]={blockType:"label",text:O.substring(3)});return/^[a-z0-9]+$/i.test(C.id)||(C.id=C.id.replace(/[^a-zA-Z0-9]/g,"")),C},self.ScratchExtensions.register(c.name||c.id,{blocks:f},w),p.vm.runtime[`ext_${c.id}`]=d}catch(f){console.warn("[CCW Polyfill] Failed to register extensions.",f)}}}else return},enumerable:!1,configurable:!0})}}}y.extensions.register(new u(y.vm))})(Scratch);(function(y){y.translate.setup(ae)})(Scratch);})();
